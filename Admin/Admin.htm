<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" /><link
  rel="icon"
  href="https://phshirt.com/wp-content/uploads/2022/01/UM-Tagum-College-1950.png"
  type="image/x-icon"
/>
  <title>UniClub Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="https://cdn.jsdelivr.net/npm/lucide@0.268.0/dist/lucide.esm.min.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/lucide@0.268.0/dist/lucide.min.js"></script>
  <style>
    .sidebar-collapsed {
      width: 72px;
    }

    .sidebar-expanded {
      width: 260px;
    }

    table td,
    table th {
      vertical-align: middle;
    }

    .club-summary:hover {
      background-color: #f8fafc;
    }

    .officer-row:hover {
      background-color: #ffffff;
    }

    .modal-overlay {
      background: rgba(2, 6, 23, 0.45);
    }

    .requirement-item {
      transition: all 0.2s ease;
    }

    .requirement-item:hover {
      transform: translateX(2px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body class="min-h-screen bg-slate-50 font-sans text-slate-900">

  <div class="flex h-screen">
    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar-expanded bg-white border-r shadow-sm transition-all duration-200 flex flex-col">
      <div class="px-4 py-4 flex items-center justify-between border-b">
        <div class="flex items-center space-x-3">
          <!-- Logo Image -->
          <div id="logoCircle"
            class="w-12 h-12   rounded-md overflow-hidden flex items-center justify-center">
            <img src="https://phshirt.com/wp-content/uploads/2022/01/UM-Tagum-College-1950.png" alt="UniClub Logo" class="object-cover w-full h-full" />
          </div>
          <div id="brandText" class="flex flex-col">
            <span id="brandTitle" class="text-sm font-extrabold text-[#a10109d1]">UniClub</span>
            <span class="text-xs text-slate-500">Admin Panel</span>
          </div>
        </div>
        <button id="collapseBtn" class="p-1 rounded hover:bg-slate-100" title="Collapse sidebar">
          <i data-lucide="chevrons-left" class="lucide w-5 h-5 text-slate-600"></i>
        </button>
      </div>

      <nav class="px-3 py-4 flex-1">
        <ul class="space-y-1">
          <li>
            <button onclick="showPage('dashboard', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="grid" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Dashboard</span>
            </button>
          </li>
          <li>
            <button onclick="showPage('officers', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="users" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Officers</span>
            </button>
          </li>
          <li>
            <button onclick="showPage('clubs', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="building-2" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Clubs</span>
            </button>
          </li>
            <li>
              <button onclick="showPage('analytics', this)"
                class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
                <i data-lucide="bar-chart-3" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                <span class="nav-label text-sm font-medium text-slate-700">Analytics</span>
              </button>
            </li>
            <li>
              <button onclick="showPage('officerRoles', this)"
                class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
                <i data-lucide="user-check" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                <span class="nav-label text-sm font-medium text-slate-700">Officer Roles</span>
              </button>
            </li>
            <li>
              <button onclick="showPage('requirements', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="clipboard-list" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Requirements/Activities</span>
            </button>
          </li>
          <li>
            <button onclick="showPage('communication', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="message-circle" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Communication</span>
            </button>
          </li>
          <li>
            <button onclick="showPage('reports', this)"
              class="nav-item w-full flex items-center gap-3 px-3 py-2 rounded-md hover:bg-slate-100">
              <i data-lucide="file-text" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              <span class="nav-label text-sm font-medium text-slate-700">Reports</span>
            </button>
          </li>
        </ul>
      </nav>

      <div class="px-4 py-4 border-t">
        <button id="logout"
          class="w-full flex items-center gap-2 justify-center px-3 py-2 rounded-md bg-red-50 text-red-600 hover:bg-red-100">
          <i data-lucide="log-out" class="lucide w-4 h-4"></i>
          <span class="text-sm font-medium">Sign out</span>
        </button>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 flex flex-col">
      <!-- TOPBAR -->
      <header class="flex items-center justify-between px-6 py-4 border-b bg-white">
        <div class="flex items-center gap-4">
          <button id="mobileMenuBtn" class="md:hidden p-1 rounded hover:bg-slate-100" title="Toggle sidebar">
            <i data-lucide="menu" class="lucide w-5 h-5 text-slate-600"></i>
          </button>
          <h1 id="pageTitle" class="text-xl font-semibold text-slate-800">Dashboard</h1>
        </div>

        <div class="flex items-center gap-4">
          <div class="text-sm text-slate-600">Admin</div>
          <div id="avatarA" class="w-9 h-9 bg-[#a10109d1] rounded-full flex items-center justify-center text-white">A
          </div>
        </div>
      </header>

      <!-- CONTENT -->
      <main class="p-6 overflow-auto">
        <!-- DASHBOARD -->
        <section id="dashboard" class="page">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Total Officers</p>
                  <p id="totalOfficers" class="text-2xl font-bold text-[#a10109d1]">0</p>
                </div>
                <i data-lucide="users" class="lucide w-8 h-8 text-red-300"></i>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Total Clubs</p>
                  <p id="totalClubs" class="text-2xl font-bold text-[#a10109d1]">0</p>
                </div>
                <i data-lucide="building-2" class="lucide w-8 h-8 text-red-300"></i>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Reports Exported</p>
                  <p id="reportsCount" class="text-2xl font-bold text-[#facc15]">0</p>
                </div>
                <i data-lucide="download" class="lucide w-8 h-8 text-yellow-300"></i>
              </div>
            </div>
          </div>

          <!-- Analytics Section -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="bar-chart-3" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                Quick Analytics
              </h3>
              <div class="space-y-4">
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600">Active Clubs</span>
                  <span class="font-semibold text-[#a10109d1]" id="activeClubs">0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600">Officers per Club (Avg)</span>
                  <span class="font-semibold text-[#a10109d1]" id="avgOfficersPerClub">0</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600">Most Active Department</span>
                  <span class="font-semibold text-[#a10109d1]" id="mostActiveDept">-</span>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-sm text-slate-600">Total Activities</span>
                  <span class="font-semibold text-[#a10109d1]" id="totalActivities">0</span>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="message-circle" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                Quick Communication
              </h3>
              <div class="space-y-3">
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                  <i data-lucide="mail" class="lucide w-4 h-4 text-slate-500"></i>
                  <span class="text-sm text-slate-600">Unread Messages</span>
                  <span class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full" id="unreadMessages">0</span>
                </div>
                <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                  <i data-lucide="bell" class="lucide w-4 h-4 text-slate-500"></i>
                  <span class="text-sm text-slate-600">Pending Notifications</span>
                  <span class="ml-auto bg-yellow-500 text-white text-xs px-2 py-1 rounded-full" id="pendingNotifications">0</span>
                </div>
                <button onclick="showPage('communication', this)" class="w-full mt-4 px-4 py-2 bg-[#a10109d1] text-white rounded-lg hover:bg-[#8a0108] transition">
                  <i data-lucide="send" class="lucide w-4 h-4 inline mr-2"></i>
                  Send Announcement
                </button>
              </div>
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="activity" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              Recent Activity
            </h3>
            <div id="recentActivity" class="space-y-3">
              <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                <i data-lucide="user-plus" class="lucide w-4 h-4 text-green-500"></i>
                <span class="text-sm text-slate-600">New officer added to Tech Innovators</span>
                <span class="ml-auto text-xs text-slate-500">2 hours ago</span>
              </div>
              <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                <i data-lucide="building-2" class="lucide w-4 h-4 text-blue-500"></i>
                <span class="text-sm text-slate-600">New club "Art Society" registered</span>
                <span class="ml-auto text-xs text-slate-500">1 day ago</span>
              </div>
              <div class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg">
                <i data-lucide="download" class="lucide w-4 h-4 text-yellow-500"></i>
                <span class="text-sm text-slate-600">Officers report exported</span>
                <span class="ml-auto text-xs text-slate-500">3 days ago</span>
              </div>
            </div>
          </div>
        </section>

        <!-- OFFICERS -->
        <section id="officers" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">Manage Officers</h2>
            <div class="flex items-center gap-2">
              <!-- changed: open Add modal instead of toggling inline form -->
              <button onclick="openAddOfficerModal()"
                class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">
                <i data-lucide="plus" class="lucide w-4 h-4"></i>
                <span class="text-sm">Create Officer</span>
              </button>
              <button onclick="exportCSV()"
                class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#facc15] text-black shadow">
                <i data-lucide="download" class="lucide w-4 h-4"></i>
                <span class="text-sm">Export CSV</span>
              </button>
            </div>
          </div>

          <!-- Officer Form (kept intact, but Create now opens modal) -->
          <form id="officerForm" onsubmit="addOfficer(event)" class="bg-white border rounded-xl p-5 shadow mb-5 hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <input id="name" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Full Name" required />
              <input id="birthday" type="date" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                required />
              <input id="studentId" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Student ID" required />
              <input id="department" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Department" required />
              <input id="program" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Program" required />
              <input id="club" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Club" required />
              <select id="role" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1] md:col-span-3">
                <option>President</option>
                <option>Vice President</option>
                <option>Treasurer</option>
                <option>Secretary</option>
                <option>Public Information Officer</option>
                <option>Peace Officer</option>
              </select>
            </div>

            <div class="mt-4 flex justify-end">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">Save Officer</button>
            </div>
          </form>

          <!-- Officers Table -->
          <div class="bg-white border rounded-2xl shadow overflow-auto">
            <table class="w-full min-w-[1000px]">
              <thead class="bg-[#a10109d1] text-white">
                <tr>
                  <th class="text-left p-4">Name</th>
                  <th class="text-left p-4">Student ID</th>
                  <th class="text-left p-4">Department</th>
                  <th class="text-left p-4">Program</th>
                  <th class="text-left p-4">Club</th>
                  <th class="text-left p-4">Role</th>
                  <th class="text-left p-4">Permissions</th>
                  <th class="text-left p-4">Actions</th>
                </tr>
              </thead>

              <!-- tbody filled by JS -->
              <tbody id="officerList" class="bg-white divide-y divide-gray-100"></tbody>
            </table>
          </div>

          <!-- Save Changes button -->
          <div class="mt-4 flex justify-end">
            <button id="saveChangesBtn" onclick="saveChanges()" disabled
              class="px-4 py-2 rounded-lg bg-green-600 text-white shadow opacity-50">
              Save Changes
            </button>
          </div>
        </section>

        <!-- CLUBS -->
        <section id="clubs" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-4">
            <h2 class="text-lg font-semibold">Manage Clubs</h2>
            <div class="flex items-center gap-2">
              <button onclick="toggleClubForm()" class="px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">Create
                Club</button>
              <button onclick="exportClubsCSV()" class="px-4 py-2 rounded-lg bg-[#facc15] text-black shadow">Export
                CSV</button>
            </div>
          </div>

          <!-- Club Form -->
          <form id="clubForm" onsubmit="addClub(event)" class="bg-white border rounded-xl p-5 shadow mb-5 hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <input id="clubName" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Club Name" required />
              <input id="clubDept" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Department" required />
              <input id="clubAdviser" class="border rounded-md px-3 py-2 focus:ring-2 focus:ring-[#a10109d1]"
                placeholder="Adviser" required />
            </div>
            <div class="mt-4 flex justify-end">
              <button type="submit" class="px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">Save Club</button>
            </div>
          </form>

          <!-- Clubs Table -->
          <div class="bg-white border rounded-2xl shadow overflow-auto">
            <table class="w-full min-w-[600px]">
              <thead class="bg-[#a10109d1] text-white">
                <tr>
                  <th class="text-left p-4">Club Name</th>
                  <th class="text-left p-4">Department</th>
                  <th class="text-left p-4">Adviser</th>
                  <th class="text-left p-4">Actions</th>
                </tr>
              </thead>
              <tbody id="clubList" class="bg-white divide-y divide-gray-100"></tbody>
            </table>
          </div>
        </section>

        <!-- ANALYTICS -->
        <section id="analytics" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-lg font-semibold">Analytics Dashboard</h2>
            <div class="flex items-center gap-2">
              <button onclick="refreshAnalytics()" class="px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">
                <i data-lucide="refresh-cw" class="lucide w-4 h-4 inline mr-2"></i>
                Refresh Data
              </button>
            </div>
          </div>

          <!-- Analytics Cards -->
          <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Club Distribution</p>
                  <p class="text-2xl font-bold text-[#a10109d1]" id="clubDistribution">0</p>
                </div>
                <i data-lucide="pie-chart" class="lucide w-8 h-8 text-blue-300"></i>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Department Activity</p>
                  <p class="text-2xl font-bold text-[#a10109d1]" id="deptActivity">0</p>
                </div>
                <i data-lucide="trending-up" class="lucide w-8 h-8 text-green-300"></i>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Role Distribution</p>
                  <p class="text-2xl font-bold text-[#a10109d1]" id="roleDistribution">0</p>
                </div>
                <i data-lucide="users" class="lucide w-8 h-8 text-purple-300"></i>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-sm text-slate-500">Growth Rate</p>
                  <p class="text-2xl font-bold text-[#a10109d1]" id="growthRate">0%</p>
                </div>
                <i data-lucide="bar-chart-3" class="lucide w-8 h-8 text-yellow-300"></i>
              </div>
            </div>
          </div>

          <!-- Charts Section -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4">Club Membership Distribution</h3>
              <div class="h-64 flex items-center justify-center bg-slate-50 rounded-lg">
                <div class="text-center">
                  <i data-lucide="pie-chart" class="lucide w-16 h-16 text-slate-400 mx-auto mb-2"></i>
                  <p class="text-slate-500">Chart visualization would go here</p>
                </div>
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4">Monthly Activity Trends</h3>
              <div class="h-64 flex items-center justify-center bg-slate-50 rounded-lg">
                <div class="text-center">
                  <i data-lucide="trending-up" class="lucide w-16 h-16 text-slate-400 mx-auto mb-2"></i>
                  <p class="text-slate-500">Trend chart would go here</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Detailed Analytics Table -->
          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-lg font-semibold mb-4">Department Analytics</h3>
            <div class="overflow-auto">
              <table class="w-full">
                <thead class="bg-[#a10109d1] text-white">
                  <tr>
                    <th class="text-left p-4">Department</th>
                    <th class="text-left p-4">Total Officers</th>
                    <th class="text-left p-4">Active Clubs</th>
                    <th class="text-left p-4">Activity Score</th>
                    <th class="text-left p-4">Trend</th>
                  </tr>
                </thead>
                <tbody id="analyticsTable" class="bg-white divide-y divide-gray-100">
                  <!-- Filled by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- OFFICER ROLES -->
        <section id="officerRoles" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-lg font-semibold">Officer Roles Management</h2>
            <div class="flex items-center gap-2">
              <button onclick="refreshOfficerRoles()" class="px-4 py-2 rounded-lg bg-[#a10109d1] text-white shadow">
                <i data-lucide="refresh-cw" class="lucide w-4 h-4 inline mr-2"></i>
                Refresh Data
              </button>
            </div>
          </div>

          <!-- Officer Roles by Club -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="users" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                Officers by Club
              </h3>
              <div id="officersByClub" class="space-y-3">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>

            <div class="bg-white rounded-2xl p-6 shadow">
              <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="user-check" class="lucide w-5 h-5 text-[#a10109d1]"></i>
                Role Distribution
              </h3>
              <div id="roleDistribution" class="space-y-3">
                <!-- Will be populated by JavaScript -->
              </div>
            </div>
          </div>

          <!-- All Officers Table -->
          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="table" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              All Officers Overview
            </h3>
            <div class="overflow-auto">
              <table class="w-full">
                <thead class="bg-[#a10109d1] text-white">
                  <tr>
                    <th class="text-left p-4">Name</th>
                    <th class="text-left p-4">Club</th>
                    <th class="text-left p-4">Role</th>
                    <th class="text-left p-4">Department</th>
                    <th class="text-left p-4">Status</th>
                    <th class="text-left p-4">Actions</th>
                  </tr>
                </thead>
                <tbody id="allOfficersTable" class="bg-white divide-y divide-gray-100">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- REQUIREMENTS/ACTIVITIES -->
        <section id="requirements" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-lg font-semibold">Requirements & Activities Management</h2>
          </div>

          <!-- Officer Uploads Section -->
          <div class="bg-white rounded-2xl p-6 shadow mb-6">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="upload" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              Officer Requirements Uploads
              <button onclick="refreshOfficerData()" class="ml-auto px-3 py-1 rounded-md bg-blue-500 text-white text-sm hover:bg-blue-600">
                <i data-lucide="refresh-cw" class="lucide w-4 h-4 inline mr-1"></i>
                Refresh
              </button>
            </h3>
            <div id="officerUploadsContent">
              <!-- Officer uploads will be displayed here -->
            </div>
          </div>

          <!-- Activities Section -->
          <div class="bg-white rounded-2xl p-6 shadow">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <i data-lucide="calendar" class="lucide w-5 h-5 text-[#a10109d1]"></i>
              Upcoming Activities
            </h3>
            <div class="overflow-auto">
              <table class="w-full">
                <thead class="bg-[#a10109d1] text-white">
                  <tr>
                    <th class="text-left p-4">Activity</th>
                    <th class="text-left p-4">Club</th>
                    <th class="text-left p-4">Date</th>
                    <th class="text-left p-4">Location</th>
                    <th class="text-left p-4">Status</th>
                    <th class="text-left p-4">Actions</th>
                  </tr>
                </thead>
                <tbody id="activitiesTable" class="bg-white divide-y divide-gray-100">
                  <!-- Filled by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- COMMUNICATION -->
        <section id="communication" class="page hidden mt-6">
          <div class="flex items-center justify-between mb-6">
            <h2 class="text-lg font-semibold">Communication</h2>
          </div>

          <!-- Communication Card -->
          <div class="bg-white rounded-2xl p-8 shadow-lg max-w-2xl mx-auto">
            <h3 class="text-2xl font-bold text-slate-800 mb-3">Communication</h3>
            <p class="text-slate-600 mb-6">Post announcements or event reminders.</p>
            <button onclick="openCreatePostModal()" class="px-6 py-3 rounded-lg bg-[#a10109d1] text-white font-medium hover:bg-[#8e0e00] transition-colors shadow-md">
              Create Post
            </button>
          </div>
        </section>

        <!-- REPORTS -->
        <section id="reports" class="page hidden mt-6">
          <div class="bg-white border rounded-xl p-6 shadow">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold">Reports</h2>
              <div class="text-sm text-slate-500">Export / manage reports</div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="p-4 border rounded-lg">
                <p class="text-sm text-slate-600">Officer List</p>
                <div class="mt-3">
                  <button onclick="exportCSV()"
                    class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#facc15] text-black shadow">
                    <i data-lucide="download" class="lucide w-4 h-4"></i>
                    Export Officers CSV
                  </button>
                </div>
              </div>

              <div class="p-4 border rounded-lg">
                <p class="text-sm text-slate-600">Clubs</p>
                <div class="mt-3">
                  <button onclick="exportClubsCSV()"
                    class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#facc15] text-black shadow">
                    <i data-lucide="download" class="lucide w-4 h-4"></i>
                    Export Clubs CSV
                  </button>
                </div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- MODALS -->
  <!-- Officer Edit/Add Modal -->
  <div id="officerModalOverlay" class="fixed inset-0 hidden items-center justify-center modal-overlay z-40">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4">
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <h3 id="officerModalTitle" class="text-lg font-semibold">Edit Officer</h3>
        <button onclick="closeOfficerModal()" class="text-slate-500 hover:text-slate-800">
          <i data-lucide="x" class="lucide w-5 h-5"></i>
        </button>
      </div>
      <form id="officerEditForm" class="p-6" onsubmit="saveOfficerEdit(event)">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div>
            <label class="text-xs text-slate-600">Full Name</label>
            <input id="edit_name" class="w-full border rounded-md px-3 py-2" required />
          </div>
          <div>
            <label class="text-xs text-slate-600">Birthday</label>
            <input id="edit_birthday" type="date" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Student ID</label>
            <input id="edit_studentId" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Department</label>
            <input id="edit_department" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Program</label>
            <input id="edit_program" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Club</label>
            <input id="edit_club" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div class="md:col-span-2">
            <label class="text-xs text-slate-600">Role</label>
            <select id="edit_role" class="w-full border rounded-md px-3 py-2">
              <option>President</option>
              <option>Vice President</option>
              <option>Treasurer</option>
              <option>Secretary</option>
              <option>Public Information Officer</option>
              <option>Peace Officer</option>
            </select>
          </div>

          <div class="md:col-span-2">
            <label class="text-xs text-slate-600">Permissions</label>
            <div id="edit_permissions" class="flex flex-wrap gap-2 mt-2"></div>
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-2">
          <button type="button" onclick="closeOfficerModal()" class="px-4 py-2 rounded-md border">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-md bg-[#a10109d1] text-white">Save changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Club Edit Modal -->
  <div id="clubModalOverlay" class="fixed inset-0 hidden items-center justify-center modal-overlay z-40">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-lg mx-4">
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <h3 class="text-lg font-semibold">Edit Club</h3>
        <button onclick="closeClubModal()" class="text-slate-500 hover:text-slate-800">
          <i data-lucide="x" class="lucide w-5 h-5"></i>
        </button>
      </div>
      <form id="clubEditForm" class="p-6" onsubmit="saveClubEdit(event)">
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="text-xs text-slate-600">Club Name</label>
            <input id="edit_club_name" class="w-full border rounded-md px-3 py-2" required />
          </div>
          <div>
            <label class="text-xs text-slate-600">Department</label>
            <input id="edit_club_dept" class="w-full border rounded-md px-3 py-2" />
          </div>
          <div>
            <label class="text-xs text-slate-600">Adviser</label>
            <input id="edit_club_adviser" class="w-full border rounded-md px-3 py-2" />
          </div>
        </div>

        <div class="mt-6 flex justify-end gap-2">
          <button type="button" onclick="closeClubModal()" class="px-4 py-2 rounded-md border">Cancel</button>
          <button type="submit" class="px-4 py-2 rounded-md bg-[#a10109d1] text-white">Save changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Requirement Files Modal -->
  <div id="requirementFilesModal" class="fixed inset-0 hidden items-center justify-center modal-overlay z-50" onclick="closeRequirementFilesModal()">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-hidden" onclick="event.stopPropagation()">
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <h3 id="requirementFilesModalTitle" class="text-lg font-semibold">Uploaded Files</h3>
        <span onclick="closeRequirementFilesModal()" class="text-slate-600 hover:text-slate-800 cursor-pointer text-xl font-bold" title="Close modal">×</span>
      </div>
      <div class="p-6 overflow-auto max-h-[calc(90vh-120px)]">
        <div id="requirementFilesContent">
          <!-- Files will be displayed here -->
        </div>
      </div>
    </div>
  </div>

  <!-- Create Post Modal -->
  <div id="createPostModal" class="fixed inset-0 hidden items-center justify-center modal-overlay z-50" onclick="closeCreatePostModal()">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-hidden" onclick="event.stopPropagation()">
      <div class="flex items-center justify-between px-6 py-4 border-b">
        <h3 class="text-lg font-semibold text-[#a10109d1]">Create Announcement / Post</h3>
        <span onclick="closeCreatePostModal()" class="text-slate-600 hover:text-slate-800 cursor-pointer text-xl font-bold" title="Close modal">×</span>
      </div>
      <div class="p-6 overflow-auto max-h-[calc(90vh-120px)]">
        <form id="createPostForm" class="space-y-6">
          <div>
            <label class="block text-sm font-medium text-[#a10109d1] mb-2">Title</label>
            <input type="text" id="postTitle" placeholder="Enter post title" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a10109d1] focus:border-transparent">
          </div>
          
          <div>
            <label class="block text-sm font-medium text-[#a10109d1] mb-2">Message</label>
            <textarea id="postMessage" rows="6" placeholder="Write your announcement here..." 
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a10109d1] focus:border-transparent resize-none"></textarea>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-[#a10109d1] mb-2">Audience</label>
            <select id="postAudience" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#a10109d1] focus:border-transparent">
              <option value="">-- Select Audience --</option>
              <option value="all">All Users</option>
              <option value="officers">Officers Only</option>
              <option value="students">Students Only</option>
              <option value="specific-club">Specific Club</option>
            </select>
          </div>
          
          <div class="flex justify-end">
            <button type="button" onclick="closeCreatePostModal()" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 mr-3">
              Cancel
            </button>
            <button type="submit" class="px-6 py-2 rounded-lg bg-[#a10109d1] text-white hover:bg-[#8e0e00] transition-colors">
              Post Announcement
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- LOGIC (only officers/clubs part changed) -->
  <script>
    // Preloaded sample data (in-memory only)
    let officers = [
      {
        name: "Juan Dela Cruz",
        birthday: "2003-01-15",
        studentId: "2023-001",
        department: "Computer Science",
        program: "BSIT",
        club: "Tech Innovators",
        role: "President",
        permissions: { view: true, edit: true, create: true, update: true, delete: true }
      },
      {
        name: "Maria Santos",
        birthday: "2004-02-22",
        studentId: "2023-002",
        department: "Humanities",
        program: "BA English",
        club: "Debate Circle",
        role: "Secretary",
        permissions: { view: true, edit: false, create: true, update: true, delete: false }
      }
    ];

    let clubs = [
      { name: "Tech Innovators", department: "Computer Science", adviser: "Dr. Santos" },
      { name: "Green Earth Society", department: "Environmental Studies", adviser: "Prof. Cruz" },
      { name: "Debate Circle", department: "Humanities", adviser: "Ms. Reyes" }
    ];

    let reportsExported = 0;

    // NAV / SIDEBAR behavior (updated with new pages)
    const pages = ["dashboard", "officers", "clubs", "analytics", "officerRoles", "requirements", "communication", "reports"];
    function showPage(id, btn) {
      pages.forEach(p => document.getElementById(p).classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
      document.getElementById("pageTitle").textContent = id.charAt(0).toUpperCase() + id.slice(1);
      document.querySelectorAll(".nav-item").forEach(n => n.classList.remove("bg-red-50"));
      if (btn) btn.classList.add("bg-red-50");
      
      // Render appropriate content based on page
      if (id === "officers") {
        renderOfficers();
      } else if (id === "clubs") {
        renderClubs();
      } else if (id === "analytics") {
        renderAnalytics();
      } else if (id === "officerRoles") {
        renderOfficerRoles();
      } else if (id === "requirements") {
        renderActivities();
        renderOfficerUploads();
      } else if (id === "communication") {
        renderCommunication();
      } else if (id === "dashboard") {
        updateDashboardAnalytics();
        updateDashboardCommunication();
      }
      
      document.getElementById("reportsCount").textContent = reportsExported;
    }

    const sidebar = document.getElementById("sidebar");
    const collapseBtn = document.getElementById("collapseBtn");
    collapseBtn.addEventListener("click", () => {
      sidebar.classList.toggle("sidebar-collapsed");
      sidebar.classList.toggle("sidebar-expanded");
      document.getElementById("brandText").classList.toggle("hidden");
      const icon = collapseBtn.querySelector("i");
      if (sidebar.classList.contains("sidebar-collapsed")) {
        icon.setAttribute("data-lucide", "chevrons-right");
      } else {
        icon.setAttribute("data-lucide", "chevrons-left");
      }
      window.lucide && window.lucide.replace();
    });

    document.getElementById("mobileMenuBtn").addEventListener("click", () => {
      sidebar.classList.toggle("hidden");
    });

    // === OFFICERS logic (UPDATED) ===
    let expandedClub = null;
    let dirty = false;
    let editingOfficerIndex = null; // null = none, >=0 = edit that index, -1 = add new

    const defaultPermissionKeys = ['view', 'edit', 'create', 'update', 'delete'];

    function markDirty() {
      dirty = true;
      const btn = document.getElementById('saveChangesBtn');
      if (btn) { btn.disabled = false; btn.classList.remove('opacity-50'); }
    }
    function clearDirty() {
      dirty = false;
      const btn = document.getElementById('saveChangesBtn');
      if (btn) { btn.disabled = true; btn.classList.add('opacity-50'); }
    }

    // Keep inline form behavior in case you still want it, but the Create button opens the modal now.
    function toggleOfficerForm() { document.getElementById("officerForm").classList.toggle("hidden"); }

    function addOfficer(e) {
      e.preventDefault();
      const officer = {
        name: document.getElementById("name").value,
        birthday: document.getElementById("birthday").value,
        studentId: document.getElementById("studentId").value,
        department: document.getElementById("department").value,
        program: document.getElementById("program").value,
        club: document.getElementById("club").value,
        role: document.getElementById("role").value,
        permissions: { view: false, edit: false, create: false, update: false, delete: false }
      };
      officers.push(officer);
      markDirty();
      renderOfficers();
      e.target.reset();
      toggleOfficerForm();
    }

    function togglePermission(index, key, value) {
      officers[index].permissions[key] = value;
      markDirty();
      renderOfficers();
    }

    function toggleClubExpand(clubName) {
      expandedClub = expandedClub === clubName ? null : clubName;
      renderOfficers();
    }

    function deleteOfficer(index) {
      if (!confirm("Delete this officer?")) return;
      officers.splice(index, 1);
      markDirty();
      renderOfficers();
    }

    function renderPermissions(officer, index, editable) {
      return Object.keys(officer.permissions).map(key => `
        <label class="inline-flex items-center gap-2 px-2 py-1 rounded-md border bg-slate-50 hover:bg-red-50 cursor-pointer text-xs">
          <input type="checkbox"
            ${officer.permissions[key] ? "checked" : ""}
            ${editable ? `onchange="togglePermission(${index}, '${key}', this.checked)"` : "disabled"}
            class="h-3 w-3 text-[#a10109d1] focus:ring-[#a10109d1] rounded">
          <span class="capitalize text-slate-700">${key}</span>
        </label>
      `).join("");
    }

    function renderOfficers() {
      const list = document.getElementById("officerList");
      list.innerHTML = "";

      // Display all officers in a flat list instead of grouped by club
      officers.forEach((o, officerIndex) => {
        list.innerHTML += `
          <tr class="officer-row bg-white hover:bg-slate-50">
            <td class="p-3"><span class="font-medium">${escapeHtml(o.name)}</span></td>
            <td class="p-3 text-sm text-slate-700">${escapeHtml(o.studentId)}</td>
            <td class="p-3 text-sm text-slate-700">${escapeHtml(o.department)}</td>
            <td class="p-3 text-sm text-slate-700">${escapeHtml(o.program)}</td>
            <td class="p-3 text-sm text-slate-700">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
                ${escapeHtml(o.club)}
              </span>
            </td>
            <td class="p-3 text-sm text-slate-700">
              <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${
                o.role === 'President' ? 'bg-red-100 text-red-800' : 
                o.role === 'Vice President' ? 'bg-orange-100 text-orange-800' :
                o.role === 'Treasurer' ? 'bg-green-100 text-green-800' :
                o.role === 'Secretary' ? 'bg-purple-100 text-purple-800' :
                'bg-gray-100 text-gray-800'
              }">
                ${escapeHtml(o.role)}
              </span>
            </td>
            <td class="p-3"><div class="flex flex-wrap gap-1">${renderPermissions(o, officerIndex, false)}</div></td>
            <td class="p-3 flex gap-2">
              <button onclick="openOfficerModal(${officerIndex})" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs hover:bg-blue-600 transition">Edit</button>
              <button onclick="deleteOfficer(${officerIndex})" class="px-3 py-1 rounded-md bg-red-500 text-white text-xs hover:bg-red-600 transition">Delete</button>
            </td>
          </tr>
        `;
      });

      document.getElementById("totalOfficers").textContent = officers.length;
      window.lucide && window.lucide.replace();
      if (!dirty) clearDirty();
    }

    // === Officer Modal functions (now supports Add and Edit) ===
    function openOfficerModal(index) {
      // index >=0 -> edit that officer
      // set editingOfficerIndex and fill fields, then show modal
      editingOfficerIndex = index;
      const o = officers[index];
      if (!o) return;
      document.getElementById('officerModalTitle').textContent = 'Edit Officer';
      document.getElementById('edit_name').value = o.name || "";
      document.getElementById('edit_birthday').value = o.birthday || "";
      document.getElementById('edit_studentId').value = o.studentId || "";
      document.getElementById('edit_department').value = o.department || "";
      document.getElementById('edit_program').value = o.program || "";
      document.getElementById('edit_club').value = o.club || "";
      document.getElementById('edit_role').value = o.role || "";

      const permContainer = document.getElementById('edit_permissions');
      permContainer.innerHTML = "";
      Object.keys(o.permissions).forEach(key => {
        const id = `perm_off_${index}_${key}`;
        const checked = o.permissions[key] ? "checked" : "";
        permContainer.insertAdjacentHTML('beforeend', `
          <label class="inline-flex items-center gap-2 px-2 py-1 rounded-md border bg-slate-50 cursor-pointer text-xs">
            <input id="${id}" type="checkbox" ${checked} class="h-4 w-4 text-[#a10109d1] rounded" />
            <span class="capitalize text-slate-700">${key}</span>
          </label>
        `);
      });

      const overlay = document.getElementById('officerModalOverlay');
      overlay.classList.remove('hidden'); overlay.classList.add('flex');
    }

    function openAddOfficerModal() {
      // open modal in add mode
      editingOfficerIndex = -1;
      document.getElementById('officerModalTitle').textContent = 'Add Officer';
      document.getElementById('edit_name').value = "";
      document.getElementById('edit_birthday').value = "";
      document.getElementById('edit_studentId').value = "";
      document.getElementById('edit_department').value = "";
      document.getElementById('edit_program').value = "";
      document.getElementById('edit_club').value = "";

      const permContainer = document.getElementById('edit_permissions');
      permContainer.innerHTML = "";
      defaultPermissionKeys.forEach(key => {
        const id = `perm_off_-1_${key}`;
        permContainer.insertAdjacentHTML('beforeend', `
          <label class="inline-flex items-center gap-2 px-2 py-1 rounded-md border bg-slate-50 cursor-pointer text-xs">
            <input id="${id}" type="checkbox" class="h-4 w-4 text-[#a10109d1] rounded" />
            <span class="capitalize text-slate-700">${key}</span>
          </label>
        `);
      });

      const overlay = document.getElementById('officerModalOverlay');
      overlay.classList.remove('hidden'); overlay.classList.add('flex');
    }

    function closeOfficerModal() {
      editingOfficerIndex = null;
      const overlay = document.getElementById('officerModalOverlay');
      overlay.classList.remove('flex'); overlay.classList.add('hidden');
    }

    function saveOfficerEdit(e) {
      if (e && e.preventDefault) e.preventDefault();
      if (editingOfficerIndex === null) return;

      const idx = editingOfficerIndex;
      const name = document.getElementById('edit_name').value;
      const birthday = document.getElementById('edit_birthday').value;
      const studentId = document.getElementById('edit_studentId').value;
      const department = document.getElementById('edit_department').value;
      const program = document.getElementById('edit_program').value;
      const clubVal = document.getElementById('edit_club').value;
      const roleVal = document.getElementById('edit_role').value;

      // build permissions object by reading checkboxes with IDs perm_off_{idx}_{key}
      const perms = {};
      const keys = (officers[idx] && officers[idx].permissions) ? Object.keys(officers[idx].permissions) : defaultPermissionKeys;
      // If adding (idx === -1) use defaultPermissionKeys
      const usedKeys = idx === -1 ? defaultPermissionKeys : keys;

      usedKeys.forEach(key => {
        const id = `perm_off_${idx}_${key}`;
        const el = document.getElementById(id);
        // when adding, ids were created with -1; when editing, created with index
        perms[key] = !!(el && el.checked);
      });

      if (idx === -1) {
        // add new
        const newOfficer = {
          name,
          birthday,
          studentId,
          department,
          program,
          club: clubVal,
          role: roleVal,
          permissions: perms
        };
        officers.push(newOfficer);
      } else {
        // update existing
        const o = officers[idx];
        o.name = name;
        o.birthday = birthday;
        o.studentId = studentId;
        o.department = department;
        o.program = program;
        o.club = clubVal;
        o.role = roleVal;
        o.permissions = perms;
      }

      markDirty();
      renderOfficers();
      closeOfficerModal();
    }

    // === CLUBS (unchanged except modal hooks) ===
    function toggleClubForm() { document.getElementById("clubForm").classList.toggle("hidden"); }

    function addClub(e) {
      e.preventDefault();
      const club = {
        name: document.getElementById("clubName").value,
        department: document.getElementById("clubDept").value,
        adviser: document.getElementById("clubAdviser").value
      };
      clubs.push(club);
      markDirty();
      renderClubs();
      e.target.reset();
      toggleClubForm();
    }

    function deleteClub(index) {
      if (!confirm("Delete this club?")) return;
      clubs.splice(index, 1);
      markDirty();
      renderClubs();
    }

    function renderClubs() {
      const list = document.getElementById("clubList");
      list.innerHTML = clubs.map((c, i) => `
        <tr>
          <td class="p-4">${escapeHtml(c.name)}</td>
          <td class="p-4">${escapeHtml(c.department)}</td>
          <td class="p-4">${escapeHtml(c.adviser)}</td>
          <td class="p-4 flex gap-2">
            <button onclick="deleteClub(${i})" class="px-3 py-1 rounded-md bg-red-500 text-white text-sm">Delete</button>
            <button onclick="openClubModal(${i})" class="px-3 py-1 rounded-md bg-blue-500 text-white text-sm">Edit</button>
          </td>
        </tr>
      `).join("");
      document.getElementById("totalClubs").textContent = clubs.length;
      window.lucide && window.lucide.replace();
    }

    // Club modal funcs
    let editingClubIndex = null;
    function openClubModal(index) {
      editingClubIndex = index;
      const c = clubs[index];
      if (!c) return;
      document.getElementById('edit_club_name').value = c.name || "";
      document.getElementById('edit_club_dept').value = c.department || "";
      document.getElementById('edit_club_adviser').value = c.adviser || "";
      const overlay = document.getElementById('clubModalOverlay'); overlay.classList.remove('hidden'); overlay.classList.add('flex');
    }
    function closeClubModal() { editingClubIndex = null; const overlay = document.getElementById('clubModalOverlay'); overlay.classList.remove('flex'); overlay.classList.add('hidden'); }
    function saveClubEdit(e) {
      if (e && e.preventDefault) e.preventDefault();
      if (editingClubIndex === null) return;
      const idx = editingClubIndex;
      const c = clubs[idx];
      c.name = document.getElementById('edit_club_name').value;
      c.department = document.getElementById('edit_club_dept').value;
      c.adviser = document.getElementById('edit_club_adviser').value;
      markDirty();
      renderClubs();
      closeClubModal();
    }

    // === Export / Reports (unchanged) ===
    function exportCSV() {
      if (officers.length === 0) return alert("No officers to export");
      let csv = "Name,Birthday,Student ID,Department,Program,Club,Role,Permissions\n";
      officers.forEach(o => {
        csv += `${o.name},${o.birthday},${o.studentId},${o.department},${o.program},${o.club},${o.role},"${JSON.stringify(o.permissions)}"\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "officers.csv";
      a.click();

      reportsExported++;
      document.getElementById("reportsCount").textContent = reportsExported;
    }

    function exportClubsCSV() {
      if (clubs.length === 0) return alert("No clubs to export");
      let csv = "Club Name,Department,Adviser\n";
      clubs.forEach(c => {
        csv += `${c.name},${c.department},${c.adviser}\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "clubs.csv";
      a.click();

      reportsExported++;
      document.getElementById("reportsCount").textContent = reportsExported;
    }

    // Save Changes placeholder
    function saveChanges() {
      if (!dirty) { alert("No changes to save."); return; }
      dirty = false; clearDirty();
      alert("Changes saved (in-memory).");
    }

    // === NEW FEATURES FUNCTIONS ===
    
    // Dashboard Analytics Update
    function updateDashboardAnalytics() {
      const activeClubs = clubs.length;
      const avgOfficersPerClub = officers.length > 0 ? Math.round(officers.length / clubs.length) : 0;
      
      // Find most active department
      const deptCount = {};
      officers.forEach(o => {
        deptCount[o.department] = (deptCount[o.department] || 0) + 1;
      });
      const mostActiveDept = Object.keys(deptCount).reduce((a, b) => deptCount[a] > deptCount[b] ? a : b, '-');
      
      document.getElementById('activeClubs').textContent = activeClubs;
      document.getElementById('avgOfficersPerClub').textContent = avgOfficersPerClub;
      document.getElementById('mostActiveDept').textContent = mostActiveDept;
      document.getElementById('totalActivities').textContent = Math.floor(Math.random() * 50) + 10; // Mock data
    }

    // Dashboard Communication Update
    function updateDashboardCommunication() {
      document.getElementById('unreadMessages').textContent = Math.floor(Math.random() * 10);
      document.getElementById('pendingNotifications').textContent = Math.floor(Math.random() * 5);
    }

    // Analytics Page Functions
    function renderAnalytics() {
      document.getElementById('clubDistribution').textContent = clubs.length;
      document.getElementById('deptActivity').textContent = Object.keys(officers.reduce((acc, o) => {
        acc[o.department] = true;
        return acc;
      }, {})).length;
      document.getElementById('roleDistribution').textContent = Object.keys(officers.reduce((acc, o) => {
        acc[o.role] = true;
        return acc;
      }, {})).length;
      document.getElementById('growthRate').textContent = '12%';

      // Render analytics table
      const analyticsTable = document.getElementById('analyticsTable');
      const deptStats = {};
      
      officers.forEach(o => {
        if (!deptStats[o.department]) {
          deptStats[o.department] = { officers: 0, clubs: new Set() };
        }
        deptStats[o.department].officers++;
        deptStats[o.department].clubs.add(o.club);
      });

      analyticsTable.innerHTML = Object.keys(deptStats).map(dept => `
        <tr>
          <td class="p-4 font-medium">${escapeHtml(dept)}</td>
          <td class="p-4">${deptStats[dept].officers}</td>
          <td class="p-4">${deptStats[dept].clubs.size}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
              ${Math.floor(Math.random() * 100)}%
            </span>
          </td>
          <td class="p-4">
            <i data-lucide="trending-up" class="lucide w-4 h-4 text-green-500"></i>
          </td>
        </tr>
      `).join('');
      
      window.lucide && window.lucide.replace();
    }

    function refreshAnalytics() {
      renderAnalytics();
      alert('Analytics data refreshed!');
    }

    // === OFFICER ROLES FUNCTIONS ===
    function renderOfficerRoles() {
      renderOfficersByClub();
      renderRoleDistribution();
      renderAllOfficersTable();
    }

    function renderOfficersByClub() {
      const container = document.getElementById('officersByClub');
      const clubOfficers = {};
      
      // Group officers by club
      officers.forEach(officer => {
        if (!clubOfficers[officer.club]) {
          clubOfficers[officer.club] = [];
        }
        clubOfficers[officer.club].push(officer);
      });

      let html = '';
      Object.keys(clubOfficers).forEach(club => {
        const clubOfficersList = clubOfficers[club];
        html += `
          <div class="border rounded-lg p-4 bg-slate-50">
            <h4 class="font-semibold text-[#a10109d1] mb-2">${escapeHtml(club)}</h4>
            <div class="space-y-1">
        `;
        
        clubOfficersList.forEach(officer => {
          const roleColor = getRoleColor(officer.role);
          html += `
            <div class="flex items-center justify-between text-sm">
              <span>${escapeHtml(officer.name)}</span>
              <span class="px-2 py-1 rounded-full text-xs ${roleColor}">${escapeHtml(officer.role)}</span>
            </div>
          `;
        });
        
        html += `
            </div>
            <div class="text-xs text-slate-500 mt-2">${clubOfficersList.length} officer(s)</div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderRoleDistribution() {
      const container = document.getElementById('roleDistribution');
      const roleCount = {};
      
      // Count officers by role
      officers.forEach(officer => {
        roleCount[officer.role] = (roleCount[officer.role] || 0) + 1;
      });

      let html = '';
      Object.keys(roleCount).forEach(role => {
        const count = roleCount[role];
        const percentage = Math.round((count / officers.length) * 100);
        const roleColor = getRoleColor(role);
        
        html += `
          <div class="flex items-center justify-between p-2 bg-slate-50 rounded">
            <div class="flex items-center gap-2">
              <span class="px-2 py-1 rounded-full text-xs ${roleColor}">${escapeHtml(role)}</span>
            </div>
            <div class="text-sm font-semibold">${count} (${percentage}%)</div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function renderAllOfficersTable() {
      const table = document.getElementById('allOfficersTable');
      table.innerHTML = officers.map(officer => `
        <tr class="hover:bg-slate-50">
          <td class="p-4 font-medium">${escapeHtml(officer.name)}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
              ${escapeHtml(officer.club)}
            </span>
          </td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${getRoleColor(officer.role)}">
              ${escapeHtml(officer.role)}
            </span>
          </td>
          <td class="p-4 text-sm text-slate-700">${escapeHtml(officer.department)}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-green-100 text-green-800">
              Active
            </span>
          </td>
          <td class="p-4 flex gap-2">
            <button onclick="viewOfficerDetails('${officer.studentId}')" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs hover:bg-blue-600">View</button>
            <button onclick="editOfficerRole('${officer.studentId}')" class="px-3 py-1 rounded-md bg-green-500 text-white text-xs hover:bg-green-600">Edit Role</button>
          </td>
        </tr>
      `).join('');
    }

    function getRoleColor(role) {
      switch(role) {
        case 'President': return 'bg-red-100 text-red-800';
        case 'Vice President': return 'bg-orange-100 text-orange-800';
        case 'Treasurer': return 'bg-green-100 text-green-800';
        case 'Secretary': return 'bg-purple-100 text-purple-800';
        case 'Public Information Officer': return 'bg-blue-100 text-blue-800';
        case 'Peace Officer': return 'bg-gray-100 text-gray-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    }

    function refreshOfficerRoles() {
      renderOfficerRoles();
      alert('Officer roles data refreshed!');
    }

    function viewOfficerDetails(studentId) {
      const officer = officers.find(o => o.studentId === studentId);
      if (officer) {
        alert(`Officer Details:\nName: ${officer.name}\nClub: ${officer.club}\nRole: ${officer.role}\nDepartment: ${officer.department}\nProgram: ${officer.program}`);
      }
    }

    function editOfficerRole(studentId) {
      const officer = officers.find(o => o.studentId === studentId);
      if (officer) {
        const newRole = prompt(`Current role: ${officer.role}\nEnter new role:`, officer.role);
        if (newRole && newRole !== officer.role) {
          officer.role = newRole;
          renderOfficerRoles();
          alert('Officer role updated!');
        }
      }
    }

    // === OFFICER UPLOADS FUNCTIONS ===
    function getOfficerUploads() {
      const uploads = JSON.parse(localStorage.getItem('officerRequirementsUploads') || '{}');
      return uploads;
    }

    function getOfficerChecklistData() {
      const checklist = JSON.parse(localStorage.getItem('requirementsActivitiesChecklist') || '{}');
      return checklist;
    }

    function getOfficerFileData() {
      const files = JSON.parse(localStorage.getItem('requirementsUploadFiles') || '[]');
      return files;
    }

    function getAllOfficerData() {
      const uploads = getOfficerUploads();
      const checklist = getOfficerChecklistData();
      const files = getOfficerFileData();
      
      return {
        uploads: uploads,
        checklist: checklist,
        files: files,
        timestamp: new Date().toISOString()
      };
    }

    function renderOfficerUploads() {
      const content = document.getElementById('officerUploadsContent');
      const officerData = getAllOfficerData();
      
      if (!officerData.checklist || Object.keys(officerData.checklist).length === 0) {
        content.innerHTML = `
          <div class="text-center py-8 text-slate-500">
            <i data-lucide="inbox" class="lucide w-12 h-12 mx-auto mb-4 text-slate-300"></i>
            <p>No officer uploads found. Officers can upload requirements from their dashboard.</p>
          </div>
        `;
        return;
      }

      const checklistItems = [
        'Approved Activity Proposal',
        'Narrative Report in paragraph', 
        'Documentation (Pictures)',
        'Evaluation Report',
        'Minutes of Meetings',
        'Liquidation with OR\'s',
        'Financial Due Diligence',
        'Due Diligence Requirements',
        'Attendance Sheets',
        'SRFOnline Reference__'
      ];

      let html = '<div class="space-y-4">';
      
      // Display checklist status
      html += `
        <div class="bg-slate-50 rounded-lg p-4">
          <h4 class="font-semibold mb-3 text-slate-700">Requirements Checklist Status</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
      `;
      
      checklistItems.forEach((item, index) => {
        const isCompleted = officerData.checklist[`requirement_${index}`] || false;
        html += `
          <div class="requirement-item flex items-center gap-2 p-3 rounded-lg ${isCompleted ? 'bg-green-50 border border-green-200' : 'bg-red-50 border border-red-200'} cursor-pointer hover:bg-opacity-80 transition-all" 
               onclick="openRequirementFilesModal('${escapeHtml(item)}', ${index})">
            <i data-lucide="${isCompleted ? 'check-circle' : 'x-circle'}" class="lucide w-4 h-4 ${isCompleted ? 'text-green-600' : 'text-red-600'}"></i>
            <span class="text-sm ${isCompleted ? 'text-green-800' : 'text-red-800'} flex-1 font-medium">${escapeHtml(item)}</span>
            <i data-lucide="chevron-right" class="lucide w-4 h-4 text-slate-400"></i>
          </div>
        `;
      });
      
      html += '</div></div>';
      
      // Display last updated timestamp
      html += `
        <div class="text-xs text-slate-500 text-center pt-2 border-t">
          Last updated: ${new Date(officerData.timestamp).toLocaleString()}
        </div>
      `;
      
      html += '</div>';
      content.innerHTML = html;
      
      // Refresh Lucide icons
      window.lucide && window.lucide.replace();
    }

    function getFileIcon(fileType) {
      if (!fileType) return 'file';
      if (fileType.includes('image')) return 'image';
      if (fileType.includes('pdf')) return 'file-text';
      if (fileType.includes('word') || fileType.includes('document')) return 'file-text';
      return 'file';
    }

    function refreshOfficerData() {
      renderOfficerUploads();
      alert('Officer data refreshed!');
    }

    // === REQUIREMENT FILES MODAL FUNCTIONS ===
    function openRequirementFilesModal(requirementName, requirementIndex) {
      const modal = document.getElementById('requirementFilesModal');
      const title = document.getElementById('requirementFilesModalTitle');
      const content = document.getElementById('requirementFilesContent');
      
      title.textContent = `Uploaded Files - ${requirementName}`;
      
      // Get officer data
      const officerData = getAllOfficerData();
      
      // Check if there are files for this specific requirement
      const requirementFiles = getFilesForRequirement(requirementIndex, officerData);
      
      if (requirementFiles.length === 0) {
        content.innerHTML = `
          <div class="text-center py-8 text-slate-500">
            <i data-lucide="file-x" class="lucide w-16 h-16 mx-auto mb-4 text-slate-300"></i>
            <p class="text-lg font-medium mb-2">No files uploaded</p>
            <p class="text-sm">No files have been uploaded for this requirement yet.</p>
          </div>
        `;
      } else {
        let html = `
          <div class="mb-4 p-4 bg-slate-50 rounded-lg">
            <h4 class="font-semibold text-slate-700 mb-2">Requirement: ${escapeHtml(requirementName)}</h4>
            <p class="text-sm text-slate-600">${requirementFiles.length} file(s) uploaded</p>
          </div>
          <div class="space-y-3">
        `;
        
        requirementFiles.forEach((file, index) => {
          const fileIcon = getFileIcon(file.type);
          const fileSize = file.size ? formatFileSize(file.size) : 'Unknown size';
          
          html += `
            <div class="flex items-center gap-4 p-4 bg-white border rounded-lg hover:bg-slate-50 transition-colors">
              <div class="flex-shrink-0">
                <i data-lucide="${fileIcon}" class="lucide w-8 h-8 text-[#a10109d1]"></i>
              </div>
              <div class="flex-1 min-w-0">
                <h5 class="font-medium text-slate-900 truncate">${escapeHtml(file.name)}</h5>
                <div class="flex items-center gap-4 text-sm text-slate-500 mt-1">
                  <span>${file.type || 'Unknown type'}</span>
                  <span>${fileSize}</span>
                  <span>${file.uploadDate || 'Recently uploaded'}</span>
                </div>
              </div>
              <div class="flex-shrink-0 flex gap-2">
                <button onclick="previewFile('${escapeHtml(file.name)}', '${file.type || ''}')" 
                        class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs hover:bg-blue-600">
                  <i data-lucide="eye" class="lucide w-4 h-4 inline mr-1"></i>
                  Preview
                </button>
                <button onclick="downloadFile('${escapeHtml(file.name)}')" 
                        class="px-3 py-1 rounded-md bg-green-500 text-white text-xs hover:bg-green-600">
                  <i data-lucide="download" class="lucide w-4 h-4 inline mr-1"></i>
                  Download
                </button>
              </div>
            </div>
          `;
        });
        
        html += '</div>';
        content.innerHTML = html;
      }
      
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      
      // Refresh Lucide icons
      window.lucide && window.lucide.replace();
    }

    function closeRequirementFilesModal() {
      const modal = document.getElementById('requirementFilesModal');
      modal.classList.remove('flex');
      modal.classList.add('hidden');
    }

    // Add keyboard support for closing modal
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('requirementFilesModal');
        if (!modal.classList.contains('hidden')) {
          closeRequirementFilesModal();
        }
      }
    });

    function getFilesForRequirement(requirementIndex, officerData) {
      // This function simulates getting files for a specific requirement
      // In a real implementation, you would filter files based on the requirement
      const requirementNames = [
        'Approved Activity Proposal',
        'Narrative Report in paragraph',
        'Documentation (Pictures)',
        'Evaluation Report',
        'Minutes of Meetings',
        'Liquidation with OR\'s',
        'Financial Due Diligence',
        'Due Diligence Requirements',
        'Attendance Sheets',
        'SRFOnline Reference__'
      ];
      
      const requirementName = requirementNames[requirementIndex];
      
      // For demo purposes, we'll show some sample files
      // In reality, this would come from the officer's uploaded files
      const sampleFiles = [
        {
          name: `${requirementName.replace(/[^a-zA-Z0-9]/g, '_')}_document.pdf`,
          type: 'application/pdf',
          size: 1024000,
          uploadDate: '2024-01-15'
        },
        {
          name: `${requirementName.replace(/[^a-zA-Z0-9]/g, '_')}_images.zip`,
          type: 'application/zip',
          size: 2048000,
          uploadDate: '2024-01-16'
        }
      ];
      
      // Check if the requirement is completed
      const isCompleted = officerData.checklist[`requirement_${requirementIndex}`] || false;
      
      // Return files only if the requirement is completed
      return isCompleted ? sampleFiles : [];
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function previewFile(fileName, fileType) {
      alert(`Preview functionality for: ${fileName}\nType: ${fileType}\n\nIn a real implementation, this would open a file preview modal.`);
    }

    function downloadFile(fileName) {
      alert(`Download functionality for: ${fileName}\n\nIn a real implementation, this would download the file.`);
    }

    // === CREATE POST MODAL FUNCTIONS ===
    function openCreatePostModal() {
      const modal = document.getElementById('createPostModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      
      // Clear form
      document.getElementById('postTitle').value = '';
      document.getElementById('postMessage').value = '';
      document.getElementById('postAudience').value = '';
    }

    function closeCreatePostModal() {
      const modal = document.getElementById('createPostModal');
      modal.classList.remove('flex');
      modal.classList.add('hidden');
    }

    // Handle form submission
    document.getElementById('createPostForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const title = document.getElementById('postTitle').value;
      const message = document.getElementById('postMessage').value;
      const audience = document.getElementById('postAudience').value;
      
      if (!title || !message || !audience) {
        alert('Please fill in all fields');
        return;
      }
      
      // In a real implementation, this would save the post
      alert(`Post created successfully!\n\nTitle: ${title}\nAudience: ${audience}\n\nIn a real implementation, this would be saved and sent to the selected audience.`);
      
      closeCreatePostModal();
    });

    // Add keyboard support for closing modal
    document.addEventListener('keydown', function(event) {
      if (event.key === 'Escape') {
        const modal = document.getElementById('createPostModal');
        if (!modal.classList.contains('hidden')) {
          closeCreatePostModal();
        }
      }
    });

    // Requirements/Activities Data
    let requirements = [
      { id: 1, requirement: "Submit Annual Report", club: "Tech Innovators", dueDate: "2024-03-15", status: "Pending" },
      { id: 2, requirement: "Budget Proposal", club: "Green Earth Society", dueDate: "2024-03-20", status: "Completed" },
      { id: 3, requirement: "Member List Update", club: "Debate Circle", dueDate: "2024-03-25", status: "Pending" }
    ];

    let activities = [
      { id: 1, activity: "Tech Workshop", club: "Tech Innovators", date: "2024-03-10", location: "Computer Lab", status: "Scheduled" },
      { id: 2, activity: "Environmental Cleanup", club: "Green Earth Society", date: "2024-03-12", location: "Campus Grounds", status: "Scheduled" },
      { id: 3, activity: "Debate Competition", club: "Debate Circle", date: "2024-03-18", location: "Auditorium", status: "Confirmed" }
    ];

    function renderRequirements() {
      const table = document.getElementById('requirementsTable');
      table.innerHTML = requirements.map(req => `
        <tr>
          <td class="p-4">${escapeHtml(req.requirement)}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
              ${escapeHtml(req.club)}
            </span>
          </td>
          <td class="p-4">${req.dueDate}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${
              req.status === 'Completed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
            }">
              ${req.status}
            </span>
          </td>
          <td class="p-4 flex gap-2">
            <button onclick="editRequirement(${req.id})" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs">Edit</button>
            <button onclick="deleteRequirement(${req.id})" class="px-3 py-1 rounded-md bg-red-500 text-white text-xs">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function renderActivities() {
      const table = document.getElementById('activitiesTable');
      table.innerHTML = activities.map(act => `
        <tr>
          <td class="p-4">${escapeHtml(act.activity)}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs bg-blue-100 text-blue-800">
              ${escapeHtml(act.club)}
            </span>
          </td>
          <td class="p-4">${act.date}</td>
          <td class="p-4">${escapeHtml(act.location)}</td>
          <td class="p-4">
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs ${
              act.status === 'Confirmed' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'
            }">
              ${act.status}
            </span>
          </td>
          <td class="p-4 flex gap-2">
            <button onclick="editActivity(${act.id})" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs">Edit</button>
            <button onclick="deleteActivity(${act.id})" class="px-3 py-1 rounded-md bg-red-500 text-white text-xs">Delete</button>
          </td>
        </tr>
      `).join('');
    }

    function openAddRequirementModal() {
      alert('Add Requirement modal would open here');
    }

    function openAddActivityModal() {
      alert('Add Activity modal would open here');
    }

    function editRequirement(id) {
      alert(`Edit requirement ${id} modal would open here`);
    }

    function deleteRequirement(id) {
      if (confirm('Delete this requirement?')) {
        requirements = requirements.filter(r => r.id !== id);
        renderRequirements();
      }
    }

    function editActivity(id) {
      alert(`Edit activity ${id} modal would open here`);
    }

    function deleteActivity(id) {
      if (confirm('Delete this activity?')) {
        activities = activities.filter(a => a.id !== id);
        renderActivities();
      }
    }

    // Communication Functions
    let messages = [
      { id: 1, from: "Tech Innovators", subject: "Meeting Schedule", content: "Our next meeting is scheduled for...", timestamp: "2 hours ago", read: false },
      { id: 2, from: "Green Earth Society", subject: "Event Update", content: "The environmental cleanup event has been...", timestamp: "1 day ago", read: true },
      { id: 3, from: "Debate Circle", subject: "Competition Results", content: "Congratulations to all participants...", timestamp: "3 days ago", read: false }
    ];

    function renderCommunication() {
      document.getElementById('totalMessages').textContent = messages.length;
      document.getElementById('unreadCount').textContent = messages.filter(m => !m.read).length;
      document.getElementById('announcementCount').textContent = Math.floor(Math.random() * 10);
      document.getElementById('responseRate').textContent = '85%';

      const messageList = document.getElementById('messageList');
      messageList.innerHTML = messages.map(msg => `
        <div class="p-3 border rounded-lg cursor-pointer hover:bg-slate-50 ${!msg.read ? 'bg-blue-50 border-blue-200' : ''}" 
             onclick="selectMessage(${msg.id})">
          <div class="flex items-center justify-between">
            <span class="font-medium text-sm">${escapeHtml(msg.from)}</span>
            <span class="text-xs text-slate-500">${msg.timestamp}</span>
          </div>
          <p class="text-sm text-slate-600 mt-1">${escapeHtml(msg.subject)}</p>
          ${!msg.read ? '<div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>' : ''}
        </div>
      `).join('');
    }

    function selectMessage(id) {
      const message = messages.find(m => m.id === id);
      if (message) {
        document.getElementById('messageContent').innerHTML = `
          <div class="mb-4">
            <h4 class="font-semibold">${escapeHtml(message.subject)}</h4>
            <p class="text-sm text-slate-500">From: ${escapeHtml(message.from)} • ${message.timestamp}</p>
          </div>
          <div class="prose">
            <p>${escapeHtml(message.content)}</p>
          </div>
        `;
        
        // Mark as read
        if (!message.read) {
          message.read = true;
          renderCommunication();
        }
      }
    }

    function openComposeModal() {
      alert('Compose message modal would open here');
    }

    function openAnnouncementModal() {
      alert('Send announcement modal would open here');
    }

    // Utility escape
    function escapeHtml(text) {
      if (text === null || text === undefined) return "";
      return String(text).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }

    // init
    function init() {
      renderOfficers();
      renderClubs();
      renderActivities();
      renderOfficerUploads();
      renderOfficerRoles();
      renderCommunication();
      updateDashboardAnalytics();
      updateDashboardCommunication();
      document.getElementById("reportsCount").textContent = reportsExported;
      showPage("dashboard", document.querySelectorAll(".nav-item")[0]);
      window.lucide && window.lucide.replace();
      clearDirty();
    }
      // Logout functionality
      document.getElementById('logout').addEventListener('click', function() {
        if (confirm('Are you sure you want to logout?')) {
          // Clear user session data
          localStorage.removeItem('userRole');
          localStorage.removeItem('userUMTCId');
          localStorage.removeItem('isLoggedIn');
          localStorage.removeItem('userName');
          localStorage.removeItem('loginTime');
          localStorage.removeItem('rememberUMTC');
          localStorage.removeItem('rememberUMTCId');
          localStorage.removeItem('rememberRole');
          
          // Redirect to login page
          window.location.href = '../Login/login.htm';
        }
      });
      
      init();
    </script>
</body>

</html>