<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title || 'Requirements & Activities | UniClub' %></title>
  <link rel="icon" href="https://phshirt.com/wp-content/uploads/2022/01/UM-Tagum-College-1950.png" type="image/x-icon">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    const renderLucideIcons = (options) => {
      if (window.lucide?.createIcons) {
        window.lucide.createIcons(options);
      } else if (window.lucide?.replace) {
        window.lucide.replace(options);
      }
    };

    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'Segoe UI', 'sans-serif'] },
          colors: {
            primary: { 700: '#7a0e0e', 800: '#6a0c0c', 900: '#5b0a0a' }
          }
        }
      }
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="font-sans antialiased bg-gradient-to-br from-gray-50 to-gray-100">
  <div class="flex h-screen">
    <%- include('./partials/sidebar', {
      activePage: 'records-requirements',
      club: (typeof club !== 'undefined' ? club : null)
    }) %>

    <main class="flex-1 overflow-auto">
      <header class="bg-white/90 backdrop-blur border-b border-gray-200 sticky top-0 z-10">
        <div class="px-6 md:px-8 py-4 flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
          <div>
            <p class="text-xs font-semibold tracking-[0.35em] uppercase text-primary-800">Records</p>
            <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 tracking-tight">Requirements & Activities</h1>
            <p class="text-gray-500 mt-1 text-sm">
              Track submissions, deadlines, and documentation for <%= club && club.name ? club.name : 'your club' %>.
            </p>
          </div>
          <div class="flex flex-wrap gap-3">
            <button class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-xl border border-gray-200 text-gray-700 hover:bg-gray-50">
              <i data-lucide="download" class="w-4 h-4"></i>
              Export summary
            </button>
            <button class="inline-flex items-center gap-2 px-4 py-2 text-sm font-semibold rounded-xl bg-primary-800 text-white hover:bg-primary-900">
              <i data-lucide="plus" class="w-4 h-4"></i>
              Add requirement
            </button>
          </div>
        </div>
      </header>

      <div class="p-6 md:p-8 space-y-8">
        <!-- Stat cards -->
        <section class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
          <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
            <p class="text-xs uppercase tracking-wide text-gray-500">Total requirements</p>
            <div class="flex items-end justify-between mt-2">
              <h3 class="text-3xl font-extrabold text-gray-900"><%= stats?.totalRequirements || 0 %></h3>
              <i data-lucide="layers" class="w-5 h-5 text-primary-800/60"></i>
            </div>
            <p class="text-xs text-gray-400 mt-3">All active submissions requested by OSA</p>
          </div>
          <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
            <p class="text-xs uppercase tracking-wide text-gray-500">Completed</p>
            <div class="flex items-end justify-between mt-2">
              <h3 class="text-3xl font-extrabold text-emerald-600"><%= stats?.completedRequirements || 0 %></h3>
              <i data-lucide="check-circle-2" class="w-5 h-5 text-emerald-500/70"></i>
            </div>
            <p class="text-xs text-gray-400 mt-3">Marked submitted / approved</p>
          </div>
          <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
            <p class="text-xs uppercase tracking-wide text-gray-500">Overdue</p>
            <div class="flex items-end justify-between mt-2">
              <h3 class="text-3xl font-extrabold text-red-600"><%= stats?.overdueRequirements || 0 %></h3>
              <i data-lucide="alert-triangle" class="w-5 h-5 text-red-500/70"></i>
            </div>
            <p class="text-xs text-gray-400 mt-3">Past due but not yet marked complete</p>
          </div>
          <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-sm">
            <p class="text-xs uppercase tracking-wide text-gray-500">Progress</p>
            <div class="flex items-end justify-between mt-2">
              <h3 class="text-3xl font-extrabold text-gray-900"><%= stats?.progress || 0 %>%</h3>
              <i data-lucide="trending-up" class="w-5 h-5 text-primary-800/60"></i>
            </div>
            <div class="mt-3 w-full bg-gray-100 rounded-full h-2">
              <div class="h-2 rounded-full bg-gradient-to-r from-primary-900 to-primary-700 transition-all duration-500" style="width: <%= stats?.progress || 0 %>%"></div>
            </div>
          </div>
        </section>

        <!-- Requirements table -->
        <section class="bg-white rounded-2xl border border-gray-100 shadow-sm">
          <div class="px-6 py-5 border-b border-gray-100 flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
            <div>
              <h2 class="text-xl font-bold text-gray-900">Submission tracker</h2>
              <p class="text-sm text-gray-500">Stay compliant by uploading proofs before each deadline.</p>
            </div>
            <div class="flex flex-wrap gap-2">
              <div class="relative">
                <i data-lucide="search" class="w-4 h-4 text-gray-400 absolute left-3 top-3"></i>
                <input type="search" placeholder="Search requirement" class="pl-9 pr-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-800">
              </div>
              <select class="px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-800">
                <option value="all">All statuses</option>
                <option value="pending">Pending</option>
                <option value="submitted">Submitted</option>
                <option value="completed">Completed</option>
              </select>
              <select class="px-3 py-2 border rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-800">
                <option value="any">Any priority</option>
                <option value="high">High</option>
                <option value="normal">Normal</option>
                <option value="low">Low</option>
              </select>
            </div>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-100 text-sm text-gray-700">
              <thead class="bg-gray-50 text-xs font-semibold text-gray-500 uppercase tracking-wide">
                <tr>
                  <th class="px-6 py-3 text-left">Requirement</th>
                  <th class="px-6 py-3 text-left">Status</th>
                  <th class="px-6 py-3 text-left">Due date</th>
                  <th class="px-6 py-3 text-left">Notes</th>
                  <th class="px-6 py-3 text-right">Actions</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-100">
                <% if (requirements && requirements.length) { %>
                  <% requirements.forEach(function(item) { 
                    const statusKey = (item.statusKey || '').toLowerCase();
                    const statusConfig = {
                      completed: { text: 'Completed', classes: 'bg-emerald-50 text-emerald-700' },
                      complete: { text: 'Completed', classes: 'bg-emerald-50 text-emerald-700' },
                      submitted: { text: 'Submitted', classes: 'bg-blue-50 text-blue-700' },
                      pending: { text: 'Pending', classes: 'bg-amber-50 text-amber-700' },
                      overdue: { text: 'Overdue', classes: 'bg-red-50 text-red-700' }
                    }[statusKey] || { text: item.status || 'Pending', classes: 'bg-gray-100 text-gray-700' };
                    const dueDate = item.dueDate ? new Date(item.dueDate) : null;
                    const isLate = dueDate && dueDate < new Date() && !['completed','complete','submitted','done'].includes(statusKey);
                  %>
                    <tr class="hover:bg-gray-50 transition">
                      <td class="px-6 py-4">
                        <p class="font-semibold text-gray-900"><%= item.title %></p>
                        <p class="text-xs text-gray-500"><%= item.description || 'No description provided' %></p>
                      </td>
                      <td class="px-6 py-4">
                        <span class="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-semibold <%= statusConfig.classes %>">
                          <span class="w-1.5 h-1.5 rounded-full bg-current"></span>
                          <%= isLate ? 'Overdue' : statusConfig.text %>
                        </span>
                      </td>
                      <td class="px-6 py-4">
                        <% if (dueDate) { %>
                          <p class="font-medium <%= isLate ? 'text-red-600' : 'text-gray-900' %>">
                            <%= dueDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) %>
                          </p>
                          <p class="text-xs text-gray-500"><%= dueDate.toLocaleDateString('en-US', { weekday: 'long' }) %></p>
                        <% } else { %>
                          <span class="text-xs text-gray-400">No deadline</span>
                        <% } %>
                      </td>
                      <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                          <% if (item.priority) { %>
                            <span class="px-2 py-0.5 rounded-full text-xs font-semibold <%= item.priority === 'high' ? 'bg-red-100 text-red-700' : item.priority === 'low' ? 'bg-blue-50 text-blue-700' : 'bg-gray-100 text-gray-700' %>">
                              Priority: <%= item.priority %>
                            </span>
                          <% } %>
                          <% if (item.updatedAt) { %>
                            <span class="px-2 py-0.5 rounded-full bg-gray-100 text-gray-500 text-xs">
                              Updated <%= new Date(item.updatedAt).toLocaleDateString() %>
                            </span>
                          <% } %>
                        </div>
                      </td>
                      <td class="px-6 py-4 text-right space-x-2">
                        <button class="px-3 py-1.5 text-xs font-semibold border rounded-lg hover:bg-gray-50">Upload proof</button>
                        <button class="px-3 py-1.5 text-xs font-semibold border rounded-lg hover:bg-gray-50">Mark done</button>
                      </td>
                    </tr>
                  <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="5" class="px-6 py-16 text-center text-gray-500 text-sm">
                      <i data-lucide="clipboard-list" class="w-8 h-8 mx-auto mb-3 text-gray-400"></i>
                      <p class="font-semibold text-gray-700">No requirements assigned yet</p>
                      <p class="text-sm text-gray-500 max-w-md mx-auto">Once OSA uploads new requirements, they will appear here.</p>
                    </td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <!-- Upcoming deadlines -->
          <section class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
            <div class="flex items-center justify-between mb-4">
              <div>
                <p class="text-xs font-semibold tracking-[0.3em] text-primary-800 uppercase">Deadlines</p>
                <h3 class="text-lg font-semibold text-gray-900">Next submissions</h3>
              </div>
              <i data-lucide="calendar-days" class="w-5 h-5 text-gray-400"></i>
            </div>
            <ul class="space-y-3 max-h-80 overflow-y-auto pr-1">
              <% const upcoming = (requirements || []).filter(req => req.dueDate).sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate)).slice(0,5); %>
              <% if (upcoming.length) { %>
                <% upcoming.forEach(function(req) { const due = new Date(req.dueDate); %>
                  <li class="flex items-center justify-between px-4 py-3 rounded-xl border border-gray-100">
                    <div>
                      <p class="font-semibold text-gray-900 text-sm"><%= req.title %></p>
                      <p class="text-xs text-gray-500"><%= req.description || 'Upload required documents' %></p>
                    </div>
                    <div class="text-right">
                      <p class="font-semibold text-gray-900 text-sm"><%= due.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %></p>
                      <p class="text-xs text-gray-500"><%= due.toLocaleDateString('en-US', { weekday: 'short' }) %></p>
                    </div>
                  </li>
                <% }) %>
              <% } else { %>
                <li class="text-center text-gray-500 text-sm py-6 border border-dashed rounded-2xl">No upcoming deadlines</li>
              <% } %>
            </ul>
          </section>

          <!-- Activities timeline -->
          <section class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
            <div class="flex items-center justify-between mb-4">
              <div>
                <p class="text-xs font-semibold tracking-[0.3em] text-primary-800 uppercase">Activities</p>
                <h3 class="text-lg font-semibold text-gray-900">Recent documentation</h3>
              </div>
              <i data-lucide="clock" class="w-5 h-5 text-gray-400"></i>
            </div>
            <div class="space-y-4 max-h-80 overflow-y-auto pr-1">
              <% if (activities && activities.length) { %>
                <% activities.forEach(function(activity) { %>
                  <div class="flex gap-3 pb-4 border-b border-gray-100 last:border-0">
                    <div class="w-10 h-10 rounded-2xl bg-gray-50 flex items-center justify-center text-gray-600">
                      <i data-lucide="clipboard-check" class="w-4 h-4"></i>
                    </div>
                    <div>
                      <p class="text-sm font-semibold text-gray-800"><%= activity.title %></p>
                      <p class="text-xs text-gray-500">
                        <%= activity.location || 'Campus' %>
                        <% if (activity.date) { %>
                          â€¢ <%= new Date(activity.date).toLocaleDateString() %>
                        <% } %>
                      </p>
                      <p class="text-xs text-gray-400 mt-1">Status: <%= activity.status || 'Scheduled' %></p>
                    </div>
                  </div>
                <% }) %>
              <% } else { %>
                <div class="text-center text-gray-500 text-sm py-8">No recorded activities yet.</div>
              <% } %>
            </div>
          </section>
        </div>

        <!-- Guidance -->
        <section class="bg-white rounded-2xl border border-gray-100 shadow-sm p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold tracking-[0.3em] text-primary-800 uppercase">Checklist</p>
              <h3 class="text-lg font-semibold text-gray-900">Submission reminders</h3>
            </div>
            <i data-lucide="info" class="w-5 h-5 text-gray-400"></i>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600">
            <div class="p-4 rounded-2xl border border-gray-100">
              <p class="font-semibold text-gray-900 mb-1">1. Gather documentation</p>
              <p class="text-xs text-gray-500">Minutes, attendance sheets, and proof of implementation.</p>
            </div>
            <div class="p-4 rounded-2xl border border-gray-100">
              <p class="font-semibold text-gray-900 mb-1">2. Upload before cutoff</p>
              <p class="text-xs text-gray-500">Send PDFs or drive links at least 24h before the deadline.</p>
            </div>
            <div class="p-4 rounded-2xl border border-gray-100">
              <p class="font-semibold text-gray-900 mb-1">3. Tag OSA contact</p>
              <p class="text-xs text-gray-500">Notify your adviser or OSA email so reviews happen faster.</p>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <script>
    const sidebar = document.getElementById('sidebar');
    if (sidebar) {
      sidebar.classList.remove('w-20');
      sidebar.classList.add('w-64');
      document.querySelectorAll('.sidebar-label').forEach(el => el.classList.remove('hidden'));
      const brandText = document.getElementById('sidebarBrandText');
      const brandLogo = document.getElementById('sidebarBrandLogo');
      if (brandText) brandText.classList.remove('hidden');
      if (brandLogo) brandLogo.classList.remove('hidden');
    }

    const recordsToggle = document.getElementById('recordsToggle');
    const recordsGroup = document.getElementById('recordsGroup');
    const recordsChevron = document.getElementById('recordsChevron');
    if (recordsToggle && recordsGroup) {
      recordsGroup.classList.remove('hidden');
      recordsToggle.setAttribute('aria-expanded', 'true');
      if (recordsChevron) {
        recordsChevron.style.transform = 'rotate(180deg)';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      renderLucideIcons();
    });
  </script>
</body>
</html>


