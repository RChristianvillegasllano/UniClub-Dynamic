<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="https://phshirt.com/wp-content/uploads/2022/01/UM-Tagum-College-1950.png" type="image/x-icon">
  <title><%= title || 'Officer Profile' %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { primary: { 800:'#6a0c0c', 900:'#5b0a0a' } }
        }
      }
    }
  </script>
  <style>
    @keyframes fade-up {
      from {
        opacity: 0;
        transform: translateY(18px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fade-up {
      opacity: 0;
      animation: fade-up 0.45s ease forwards;
    }
    .card-surface:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 40px rgba(10, 12, 20, 0.08);
    }
  </style>
</head>
<body class="font-sans antialiased bg-gradient-to-br from-gray-50 to-gray-100">
  <div class="min-h-screen">
    <% if (typeof updated !== 'undefined' && updated) { %>
      <div class="max-w-6xl mx-auto px-4 pt-6">
        <div class="rounded-2xl border border-emerald-200 bg-emerald-50 text-emerald-800 px-4 py-3 text-sm font-semibold flex items-center gap-2 animate-fade-up">
          <i data-lucide="check-circle" class="w-4 h-4"></i>
          Session details refreshed successfully.
        </div>
      </div>
    <% } %>
    <%
      var totalFields = 3;
      var have = 0;
      if (officer && officer.profile_picture) have++;
      if (officer && officer.email) have++;
      if (officer && officer.bio) have++;
      var pct = Math.round((have / totalFields) * 100);
      var missingFields = [];
      if (!(officer && officer.profile_picture)) missingFields.push('Profile Photo');
      if (!(officer && officer.email)) missingFields.push('Email');
      if (!(officer && officer.bio)) missingFields.push('Bio');
      var clubDescription = club && club.description ? club.description : '';
      var clubHasDescription = clubDescription.length > 0;
      var clubTruncated = clubDescription.length > 200 ? clubDescription.slice(0, 200) + '...' : clubDescription;
      var clubNeedsMore = clubDescription.length > 200;
      var clubProgramList = [];
      var clubProgramRaw = club && club.program ? club.program : null;
      if (Array.isArray(clubProgramRaw)) {
        clubProgramList = clubProgramRaw.filter(Boolean).map(function(entry) {
          return typeof entry === 'string' ? entry.trim() : entry;
        }).filter(Boolean);
      } else if (typeof clubProgramRaw === 'string') {
        var trimmedProgram = clubProgramRaw.trim();
        if (trimmedProgram.startsWith('[') && trimmedProgram.endsWith(']')) {
          try {
            var parsedPrograms = JSON.parse(trimmedProgram);
            if (Array.isArray(parsedPrograms)) {
              clubProgramList = parsedPrograms.filter(Boolean).map(function(entry) {
                return typeof entry === 'string' ? entry.trim() : entry;
              }).filter(Boolean);
            }
          } catch (jsonErr) {
            // fall through to manual parsing
          }
        }
        if (!clubProgramList.length && trimmedProgram.startsWith('{') && trimmedProgram.endsWith('}')) {
          clubProgramList = trimmedProgram
            .slice(1, -1)
            .split(',')
            .map(function(entry) {
              return entry.replace(/^"|"$/g, '').trim();
            })
            .filter(Boolean);
        } else if (!clubProgramList.length && trimmedProgram.includes(',')) {
          clubProgramList = trimmedProgram.split(',').map(function(entry) {
            return entry.trim();
          }).filter(Boolean);
        } else if (!clubProgramList.length && trimmedProgram) {
          clubProgramList = [trimmedProgram];
        }
      } else if (clubProgramRaw) {
        clubProgramList = [String(clubProgramRaw)];
      }
    %>
      <!-- Glassmorphic header -->
      <div class="relative">
        <div class="absolute inset-0 h-40 w-full bg-gradient-to-r from-primary-900/35 via-primary-800/25 to-amber-600/25"></div>
        <div class="relative h-40 w-full bg-[url('https://www.toptal.com/designers/subtlepatterns/uploads/moroccan-flower-dark.png')] bg-[length:320px] opacity-[0.08]"></div>
        <div class="max-w-6xl mx-auto px-4">
          <div class="-mt-16">
            <div class="bg-white/70 backdrop-blur-xl border border-white/60 rounded-2xl p-5 md:p-7 shadow-xl animate-fade-up" style="animation-delay: 40ms;">
              <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                <div class="flex items-start md:items-center gap-4">
                  <div class="relative">
                    <% if (officer && officer.profile_picture) { %>
                      <img src="<%= officer.profile_picture %>" alt="Profile" class="w-24 h-24 md:w-28 md:h-28 rounded-3xl ring-4 ring-white/70 shadow-xl object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div class="hidden w-24 h-24 md:w-28 md:h-28 rounded-3xl ring-4 ring-white/70 shadow-xl bg-gradient-to-br from-primary-900 via-primary-800 to-amber-500 items-center justify-center text-xl font-semibold text-white uppercase">
                        <%= officer && officer.name ? officer.name.charAt(0).toUpperCase() : 'UC' %>
                      </div>
                    <% } else { %>
                      <div class="w-24 h-24 md:w-28 md:h-28 rounded-3xl ring-4 ring-white/70 shadow-xl bg-gradient-to-br from-primary-900 via-primary-800 to-amber-500 flex items-center justify-center text-xl font-semibold text-white uppercase">
                        <%= officer && officer.name ? officer.name.charAt(0).toUpperCase() : 'UC' %>
                      </div>
                    <% } %>
                    <button id="cameraBtn" type="button" class="absolute bottom-0 right-0 bg-primary-900 hover:bg-primary-800 text-white p-2.5 rounded-full shadow-lg transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/40" title="Change Photo" aria-label="Change profile photo">
                      <i data-lucide="camera" class="w-4 h-4"></i>
                    </button>
                  </div>
                  <div>
                    <h1 class="text-2xl md:text-3xl font-extrabold text-gray-900 tracking-tight"><%= officer && officer.name ? officer.name : 'Officer' %></h1>
                    <div class="mt-1 flex flex-wrap items-center gap-2 text-sm text-gray-600">
                      <span class="font-medium text-gray-700"><%= officer && officer.role ? officer.role : 'Club Officer' %></span>
                      <% if (club) { %>
                        <span class="text-gray-400">¬∑</span>
                        <a href="<%= club && club.id ? `/clubs/${club.id}` : '/officer' %>" class="inline-flex items-center gap-1.5 rounded-full bg-primary-900/10 px-2.5 py-1 text-xs font-semibold text-primary-900 ring-1 ring-primary-900/20 hover:bg-primary-900/15 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/50 transition" aria-label="View club details">
                          <i data-lucide="shield" class="w-3.5 h-3.5" aria-hidden="true"></i>
                          <span><%= club.name %></span>
                        </a>
                      <% } %>
                    </div>
                    <div class="mt-4 md:mt-5 flex flex-wrap items-center gap-4 md:gap-6">
                      <div class="relative flex items-center gap-3 group">
                        <div class="w-40 md:w-48 h-2 rounded-full bg-white/60 overflow-hidden">
                          <div class="progress-bar h-2 rounded-full bg-gradient-to-r from-emerald-500 via-emerald-400 to-amber-400 transition-all duration-700" style="width:0%;" data-progress-target="<%= pct %>"></div>
                        </div>
                        <span class="text-xs font-semibold text-gray-800"><%= pct %>% complete</span>
                        <% if (missingFields.length) { %>
                          <button type="button" class="relative inline-flex items-center justify-center text-gray-500 hover:text-primary-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/30 rounded-full" aria-label="Missing profile fields" data-tooltip>
                            <i data-lucide="info" class="w-4 h-4" aria-hidden="true"></i>
                            <span class="pointer-events-none absolute left-1/2 -translate-x-1/2 -translate-y-full mb-2 whitespace-nowrap rounded-md bg-gray-900/90 px-2 py-1 text-[11px] font-medium text-white opacity-0 transition group-hover:opacity-100 group-focus-within:opacity-100 shadow-lg">
                              Missing: <%= missingFields.join(', ') %>
                            </span>
                          </button>
                        <% } %>
                      </div>
                      <% if (missingFields.length) { %>
                        <span class="text-xs text-gray-600">Complete your profile to help members connect.</span>
                      <% } else { %>
                        <span class="text-xs font-semibold text-emerald-600">All key details added. Great job!</span>
                      <% } %>
                    </div>
                  </div>
                </div>
                <div class="flex flex-wrap items-center justify-end gap-3">
                  <button type="button" id="profileFormToggle" class="inline-flex items-center gap-2 rounded-lg bg-primary-900 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-primary-900/20 transition hover:bg-primary-800 hover:shadow-lg focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/40">
                    <i data-lucide="settings" class="w-4 h-4" aria-hidden="true"></i>
                    Customize your profile
                  </button>
                  <a href="/officer" class="inline-flex items-center gap-2 rounded-lg border border-primary-900/20 px-4 py-2 text-sm font-semibold text-primary-900 transition hover:bg-primary-900/10 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/30">
                    <i data-lucide="layout-dashboard" class="w-4 h-4" aria-hidden="true"></i>
                    Dashboard
                  </a>
                </div>
              </div>
            </div>
          </div>
    </div>
  </div>

  <main class="max-w-6xl mx-auto px-4 py-6 space-y-6">
    <section aria-label="Key officer facts" class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-md transition card-surface animate-fade-up" style="animation-delay: 80ms;">
        <div class="flex items-start justify-between gap-4">
          <div>
            <p class="text-[11px] font-semibold tracking-wide text-gray-500 uppercase">Role</p>
            <p class="mt-1 text-lg font-bold text-gray-900 break-words"><%= officer && officer.role ? officer.role : '‚Äî' %></p>
          </div>
          <button type="button" class="rounded-full bg-emerald-500/10 p-2 text-emerald-600 hover:text-emerald-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-400/40 transition" aria-label="Edit role">
            <i data-lucide="user-cog" class="w-4 h-4" aria-hidden="true"></i>
          </button>
        </div>
      </div>
      <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-md transition card-surface animate-fade-up" style="animation-delay: 120ms;">
        <div class="flex items-start justify-between gap-4">
          <div>
            <p class="text-[11px] font-semibold tracking-wide text-gray-500 uppercase">Program</p>
            <p class="mt-1 text-lg font-bold text-gray-900 break-words"><%= officer && officer.program ? officer.program : '‚Äî' %></p>
          </div>
          <button type="button" class="rounded-full bg-blue-500/10 p-2 text-blue-500 hover:text-blue-600 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-400/40 transition" aria-label="Edit program">
            <i data-lucide="book-open" class="w-4 h-4" aria-hidden="true"></i>
          </button>
        </div>
      </div>
      <div class="bg-white rounded-2xl p-5 border border-gray-100 shadow-md transition card-surface animate-fade-up" style="animation-delay: 160ms;">
        <div class="flex items-start justify-between gap-4">
          <div>
            <p class="text-[11px] font-semibold tracking-wide text-gray-500 uppercase">Department</p>
            <p class="mt-1 text-lg font-bold text-gray-900 break-words"><%= officer && officer.department ? officer.department : '‚Äî' %></p>
          </div>
          <button type="button" class="rounded-full bg-amber-500/10 p-2 text-amber-600 hover:text-amber-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-amber-400/40 transition" aria-label="Edit department">
            <i data-lucide="building" class="w-4 h-4" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </section>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-5 items-stretch">
      <section class="lg:col-span-2 bg-white rounded-2xl border border-gray-100 shadow-md flex flex-col animate-fade-up card-surface" style="animation-delay: 200ms;">
        <div class="p-5 md:p-6 border-b flex items-center justify-between">
          <div>
            <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
              <i data-lucide="info" class="w-5 h-5 text-primary-900" aria-hidden="true"></i>
              About
            </h2>
            <p class="mt-1 text-xs text-gray-500">Share a snapshot of who you are.</p>
          </div>
        </div>
        <div class="p-5 md:p-6 text-sm leading-6 text-gray-700 flex-1">
          <% if (officer && officer.bio) { %>
            <p class="text-[15px] text-gray-700 leading-7"><%= officer.bio %></p>
          <% } else { %>
            <p class="text-[15px] text-gray-600 leading-7">
              Your profile is looking good. Add your email and bio to help members connect with you using the ‚ÄúCustomize your profile‚Äù button.
            </p>
          <% } %>
        </div>
      </section>

      <aside class="bg-white rounded-2xl border border-gray-100 shadow-md flex flex-col animate-fade-up card-surface" style="animation-delay: 240ms;">
        <div class="p-5 md:p-6 border-b flex items-center justify-between">
          <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
            <i data-lucide="phone" class="w-5 h-5 text-primary-900" aria-hidden="true"></i>
            Contact & Actions
          </h2>
        </div>
        <div class="p-5 md:p-6 text-sm text-gray-700 space-y-4 flex-1">
          <div class="flex items-start gap-3">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-primary-900/10 text-primary-900">
              <i data-lucide="mail" class="w-4 h-4" aria-hidden="true"></i>
            </span>
            <div>
              <p class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Email</p>
              <p class="mt-0.5 break-words text-sm"><%= officer && officer.email ? officer.email : 'Not provided' %></p>
            </div>
          </div>
          <div class="flex items-start gap-3">
            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-blue-500/10 text-blue-600">
              <i data-lucide="facebook" class="w-4 h-4" aria-hidden="true"></i>
            </span>
            <div>
              <p class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Facebook</p>
              <p class="mt-0.5 break-words text-sm"><%= officer && officer.facebook ? officer.facebook : 'Not provided' %></p>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <div id="profileModal" class="fixed inset-0 z-50 hidden" role="dialog" aria-modal="true" aria-labelledby="profileModalTitle">
      <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" data-close-profile-modal></div>
      <div class="relative min-h-screen w-full flex items-center justify-center px-4 py-8">
        <div class="bg-white rounded-2xl border border-gray-100 shadow-2xl w-full max-w-3xl">
          <div class="flex items-center justify-between gap-3 p-5 border-b">
            <div>
              <h2 id="profileModalTitle" class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="settings-2" class="w-5 h-5 text-primary-900" aria-hidden="true"></i>
                Customize your profile
              </h2>
              <p class="mt-1 text-xs text-gray-500">Changes here update your officer profile.</p>
            </div>
            <button type="button" class="rounded-full p-2 text-gray-500 hover:text-primary-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/30" aria-label="Close modal" data-close-profile-modal>
              <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
            </button>
          </div>
          <form action="/officer/profile" method="POST" class="p-5 md:p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
            <div>
              <label class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Role</label>
              <input type="text" name="role" value="<%= officer && officer.role ? officer.role : '' %>" class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-900/30" placeholder="Club President">
            </div>
            <div>
              <label class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Email</label>
              <input type="email" name="email" value="<%= officer && officer.email ? officer.email : '' %>" class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-900/30" placeholder="you@umindanao.edu.ph">
            </div>
            <div>
              <label class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Facebook link</label>
              <input type="text" name="facebook" value="<%= officer && officer.facebook ? officer.facebook : '' %>" class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-900/30" placeholder="https://facebook.com/you">
            </div>
            <div class="md:col-span-2">
              <label class="text-xs font-semibold uppercase text-gray-500 tracking-wide">Bio</label>
              <textarea name="bio" rows="4" class="mt-1 w-full rounded-xl border border-gray-200 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-900/30" placeholder="Tell members about yourself"><%= officer && officer.bio ? officer.bio : '' %></textarea>
            </div>
            <div class="md:col-span-2 flex flex-wrap items-center gap-3">
              <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-primary-900 px-4 py-2 text-sm font-semibold text-white shadow-md shadow-primary-900/20 transition hover:bg-primary-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/40">
                <i data-lucide="save" class="w-4 h-4" aria-hidden="true"></i>
                Save profile
              </button>
              <p class="text-xs text-gray-500">Your updates stay even after you log out.</p>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Profile Picture Modal -->
    <div id="pictureModal" class="fixed inset-0 z-[10000] hidden" role="dialog" aria-modal="true" aria-labelledby="pictureModalTitle">
      <div class="absolute inset-0 bg-gray-900/60 backdrop-blur-sm" data-close-picture-modal></div>
      <div class="relative min-h-screen w-full flex items-center justify-center px-4 py-8">
        <div class="bg-white rounded-2xl border border-gray-100 shadow-2xl w-full max-w-md">
          <div class="flex items-center justify-between gap-3 p-5 border-b">
            <div>
              <h2 id="pictureModalTitle" class="text-lg font-semibold text-gray-900 flex items-center gap-2">
                <i data-lucide="camera" class="w-5 h-5 text-primary-900" aria-hidden="true"></i>
                Change Profile Photo
              </h2>
              <p class="mt-1 text-xs text-gray-500">Upload a new profile picture</p>
            </div>
            <button type="button" class="rounded-full p-2 text-gray-500 hover:text-primary-900 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/30" aria-label="Close modal" data-close-picture-modal>
              <i data-lucide="x" class="w-5 h-5" aria-hidden="true"></i>
            </button>
          </div>
          <div class="p-5 md:p-6">
            <!-- Preview -->
            <div class="mb-6 flex justify-center">
              <div class="relative">
                <img id="picturePreview" src="<%= officer && officer.profile_picture ? officer.profile_picture : '' %>" alt="Preview" class="<%= officer && officer.profile_picture ? '' : 'hidden' %> w-32 h-32 rounded-full object-cover border-4 border-gray-200">
                <div id="picturePreviewPlaceholder" class="<%= officer && officer.profile_picture ? 'hidden' : 'flex' %> w-32 h-32 rounded-full bg-gradient-to-br from-primary-900 via-primary-800 to-amber-500 items-center justify-center text-3xl font-semibold text-white uppercase border-4 border-gray-200">
                  <%= officer && officer.name ? officer.name.charAt(0).toUpperCase() : 'UC' %>
                </div>
              </div>
            </div>

            <!-- Upload Options -->
            <div class="space-y-4">
              <!-- File Upload Option -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Upload Image</label>
                <input type="file" id="pictureFileInput" accept="image/*" class="hidden">
                <button type="button" onclick="document.getElementById('pictureFileInput').click()" class="w-full px-4 py-2.5 rounded-xl border-2 border-gray-200 text-gray-700 font-semibold hover:bg-gray-50 transition-colors flex items-center justify-center gap-2">
                  <i data-lucide="upload" class="w-4 h-4"></i>
                  Choose File
                </button>
                <p class="text-xs text-gray-500 mt-2">Select an image file (JPG, PNG, etc.) - Max 5MB</p>
              </div>

              <!-- Divider -->
              <div class="relative">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                  <span class="px-2 bg-white text-gray-500">OR</span>
                </div>
              </div>

              <!-- URL Option -->
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Image URL</label>
                <input type="url" id="pictureUrlInput" class="w-full px-4 py-2.5 rounded-xl border border-gray-200 text-gray-900 placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-900/30" placeholder="https://example.com/image.jpg">
                <p class="text-xs text-gray-500 mt-2">Paste an image URL</p>
              </div>
            </div>

            <div class="flex gap-3 mt-6 justify-end">
              <button type="button" id="cancelPictureBtn" class="px-4 py-2 rounded-xl border border-gray-200 text-gray-700 font-semibold hover:bg-gray-50 transition-colors">Cancel</button>
              <button type="button" id="savePictureBtn" class="px-4 py-2 rounded-xl bg-primary-900 text-white font-semibold hover:bg-primary-800 transition-colors">Save Picture</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <section aria-label="Club information" class="bg-white rounded-2xl border border-gray-100 shadow-md animate-fade-up card-surface" style="animation-delay: 280ms;">
      <div class="p-5 md:p-6 border-b flex items-center justify-between gap-3">
        <div>
          <h2 class="text-lg font-semibold text-gray-900 flex items-center gap-2">
            <i data-lucide="building" class="w-5 h-5 text-primary-900" aria-hidden="true"></i>
            Club
          </h2>
          <p class="mt-1 text-xs text-gray-500">Learn more about the organization you represent.</p>
        </div>
      </div>
      <div class="p-5 md:p-6 text-sm text-gray-700 space-y-4">
        <% if (club) { %>
          <div>
            <p class="text-base font-semibold text-gray-900"><%= club.name %></p>
            <p class="mt-1 text-[15px] leading-7 text-gray-600" id="clubDescriptionText"><%= clubHasDescription ? clubTruncated : 'No description provided.' %></p>
            <% if (clubNeedsMore) { %>
              <button type="button" id="toggleClubDescription" class="mt-2 inline-flex items-center gap-1 text-sm font-semibold text-primary-900 hover:text-primary-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-900/30 rounded" aria-expanded="false">
                <span class="toggle-text">Read more</span>
                <i data-lucide="chevron-down" class="w-4 h-4" aria-hidden="true"></i>
              </button>
            <% } %>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
            <div class="flex items-start gap-2 rounded-xl border border-gray-200/60 bg-white/80 px-3 py-3">
              <span class="mt-0.5 text-primary-900">
                <i data-lucide="user" class="w-4 h-4" aria-hidden="true"></i>
              </span>
              <div>
                <p class="text-[11px] font-semibold uppercase tracking-wide text-gray-500">Adviser</p>
                <p class="text-sm font-medium text-gray-900"><%= club.adviser || '‚Äî' %></p>
              </div>
            </div>
            <div class="flex items-start gap-2 rounded-xl border border-gray-200/60 bg-white/80 px-3 py-3">
              <span class="mt-0.5 text-amber-600">
                <i data-lucide="layers" class="w-4 h-4" aria-hidden="true"></i>
              </span>
              <div>
                <p class="text-[11px] font-semibold uppercase tracking-wide text-gray-500">Category</p>
                <p class="text-sm font-medium text-gray-900"><%= club.category || '‚Äî' %></p>
              </div>
            </div>
            <div class="flex items-start gap-2 rounded-xl border border-gray-200/60 bg-white/80 px-3 py-3">
              <span class="mt-0.5 text-primary-900">
                <i data-lucide="building" class="w-4 h-4" aria-hidden="true"></i>
              </span>
              <div>
                <p class="text-[11px] font-semibold uppercase tracking-wide text-gray-500">Department</p>
                <p class="text-sm font-medium text-gray-900"><%= club.department || '‚Äî' %></p>
              </div>
            </div>
            <div class="flex items-start gap-2 rounded-xl border border-gray-200/60 bg-white/80 px-3 py-3">
              <span class="mt-0.5 text-emerald-600">
                <i data-lucide="book" class="w-4 h-4" aria-hidden="true"></i>
              </span>
              <div>
                <p class="text-[11px] font-semibold uppercase tracking-wide text-gray-500">Program</p>
                <% if (clubProgramList && clubProgramList.length) { %>
                  <% clubProgramList.forEach(function(program, idx) { %>
                    <p class="text-sm font-medium text-gray-900 <%= idx ? 'mt-1' : '' %>"><%= program %></p>
                  <% }); %>
                <% } else { %>
                  <p class="text-sm font-medium text-gray-400">‚Äî</p>
                <% } %>
              </div>
            </div>
          </div>
        <% } else { %>
          <p class="text-sm text-gray-600">No club information available.</p>
        <% } %>
      </div>
    </section>
    </main>
  </div>

  <script>
    const renderLucideIcons = (options) => {
      if (window.lucide?.createIcons) {
        window.lucide.createIcons(options);
      } else if (window.lucide?.replace) {
        window.lucide.replace(options);
      }
    };

    document.addEventListener('DOMContentLoaded', () => {
      renderLucideIcons();

      const progressBars = document.querySelectorAll('.progress-bar');
      progressBars.forEach((bar) => {
        const target = Number(bar.dataset.progressTarget || 0);
        bar.style.width = '0%';
        requestAnimationFrame(() => {
          requestAnimationFrame(() => {
            const clamped = Math.min(Math.max(target, 0), 100);
            bar.style.width = clamped + '%';
          });
        });
      });

      const animatedCards = document.querySelectorAll('.animate-fade-up');
      animatedCards.forEach((card, index) => {
        if (!card.style.animationDelay) {
          card.style.animationDelay = `${index * 60}ms`;
        }
      });

      const toggleClubDescription = document.getElementById('toggleClubDescription');
      const clubDescriptionText = document.getElementById('clubDescriptionText');
      if (toggleClubDescription && clubDescriptionText) {
        const fullText = <%- JSON.stringify(clubDescription) %>;
        const shortText = <%- JSON.stringify(clubTruncated) %>;
        let expanded = false;

        clubDescriptionText.textContent = shortText || 'No description provided.';

        toggleClubDescription.addEventListener('click', () => {
          expanded = !expanded;
          clubDescriptionText.textContent = expanded ? fullText : shortText;
          toggleClubDescription.setAttribute('aria-expanded', expanded.toString());

          const icon = toggleClubDescription.querySelector('i');
          if (icon) {
            icon.style.transform = expanded ? 'rotate(180deg)' : 'rotate(0deg)';
          }

          const label = toggleClubDescription.querySelector('.toggle-text');
          if (label) {
            label.textContent = expanded ? 'Show less' : 'Read more';
          }
        });
      }
      const profileModal = document.getElementById('profileModal');
      const modalOpenBtn = document.getElementById('profileFormToggle');
      const modalCloseEls = document.querySelectorAll('[data-close-profile-modal]');

      const setBodyScroll = (disable) => {
        if (disable) {
          document.body.classList.add('overflow-hidden');
        } else {
          document.body.classList.remove('overflow-hidden');
        }
      };

      const toggleModal = (show) => {
        if (!profileModal) return;
        if (show) {
          profileModal.classList.remove('hidden');
          modalOpenBtn?.setAttribute('aria-expanded', 'true');
          setBodyScroll(true);
          renderLucideIcons();
        } else {
          profileModal.classList.add('hidden');
          modalOpenBtn?.setAttribute('aria-expanded', 'false');
          setBodyScroll(false);
        }
      };

      modalOpenBtn?.addEventListener('click', () => toggleModal(true));
      modalCloseEls.forEach((el) =>
        el.addEventListener('click', () => toggleModal(false))
      );
      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !profileModal?.classList.contains('hidden')) {
          toggleModal(false);
        }
      });

      // Profile Picture Modal
      const pictureModal = document.getElementById('pictureModal');
      const cameraBtn = document.getElementById('cameraBtn');
      const pictureCloseEls = document.querySelectorAll('[data-close-picture-modal]');
      const pictureFileInput = document.getElementById('pictureFileInput');
      const pictureUrlInput = document.getElementById('pictureUrlInput');
      const picturePreview = document.getElementById('picturePreview');
      const picturePreviewPlaceholder = document.getElementById('picturePreviewPlaceholder');
      const savePictureBtn = document.getElementById('savePictureBtn');
      const cancelPictureBtn = document.getElementById('cancelPictureBtn');
      
      let selectedPicture = null;
      let pictureSource = null; // 'file' or 'url'

      const togglePictureModal = (show) => {
        if (!pictureModal) return;
        if (show) {
          pictureModal.classList.remove('hidden');
          setBodyScroll(true);
          renderLucideIcons();
        } else {
          pictureModal.classList.add('hidden');
          setBodyScroll(false);
          // Reset inputs
          if (pictureFileInput) pictureFileInput.value = '';
          if (pictureUrlInput) pictureUrlInput.value = '';
          selectedPicture = null;
          pictureSource = null;
          // Reset preview
          if (picturePreview) {
            const currentSrc = picturePreview.src;
            if (currentSrc && (currentSrc.startsWith('data:') || currentSrc.startsWith('http'))) {
              picturePreview.classList.remove('hidden');
              picturePreviewPlaceholder?.classList.add('hidden');
            } else {
              picturePreview.classList.add('hidden');
              picturePreviewPlaceholder?.classList.remove('hidden');
            }
          }
        }
      };

      cameraBtn?.addEventListener('click', () => togglePictureModal(true));
      pictureCloseEls.forEach((el) => el.addEventListener('click', () => togglePictureModal(false)));
      cancelPictureBtn?.addEventListener('click', () => togglePictureModal(false));

      document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && !pictureModal?.classList.contains('hidden')) {
          togglePictureModal(false);
        }
      });

      // File input change handler
      pictureFileInput?.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          // Validate file type
          if (!file.type.startsWith('image/')) {
            alert('Please select a valid image file');
            return;
          }

          // Validate file size (max 5MB)
          if (file.size > 5 * 1024 * 1024) {
            alert('Image size must be less than 5MB');
            return;
          }

          // Clear URL input when file is selected
          if (pictureUrlInput) pictureUrlInput.value = '';
          
          // Read file and show preview
          const reader = new FileReader();
          reader.onload = function(e) {
            selectedPicture = e.target.result; // Base64 data URL
            pictureSource = 'file';
            
            if (picturePreview) {
              picturePreview.src = selectedPicture;
              picturePreview.classList.remove('hidden');
              picturePreviewPlaceholder?.classList.add('hidden');
            }
            renderLucideIcons();
          };
          reader.readAsDataURL(file);
        }
      });

      // URL input change handler
      pictureUrlInput?.addEventListener('input', function(e) {
        const url = e.target.value.trim();
        if (url && (url.startsWith('http://') || url.startsWith('https://'))) {
          selectedPicture = url;
          pictureSource = 'url';
          
          if (picturePreview) {
            picturePreview.src = url;
            picturePreview.classList.remove('hidden');
            picturePreviewPlaceholder?.classList.add('hidden');
            picturePreview.onerror = function() {
              this.classList.add('hidden');
              picturePreviewPlaceholder?.classList.remove('hidden');
            };
          }
        } else if (!url) {
          selectedPicture = null;
          pictureSource = null;
          if (picturePreview) {
            const currentSrc = picturePreview.src;
            if (currentSrc && (currentSrc.startsWith('data:') || currentSrc.startsWith('http'))) {
              picturePreview.classList.remove('hidden');
              picturePreviewPlaceholder?.classList.add('hidden');
            } else {
              picturePreview.classList.add('hidden');
              picturePreviewPlaceholder?.classList.remove('hidden');
            }
          }
        }
      });

      // Save picture handler
      savePictureBtn?.addEventListener('click', async function() {
        if (!selectedPicture) {
          alert('‚ö†Ô∏è Please select an image file or enter an image URL to update your profile photo.');
          return;
        }

        // Get CSRF token
        const csrfToken = document.querySelector('input[name="_csrf"]')?.value || 
                         document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';

        if (!csrfToken) {
          alert('‚ö†Ô∏è Security token not found. Please refresh the page and try again.');
          return;
        }

        // Disable button during save
        savePictureBtn.disabled = true;
        savePictureBtn.textContent = 'Saving...';

        try {
          const response = await fetch('/officer/profile/picture', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Accept': 'application/json'
            },
            body: JSON.stringify({ 
              profile_picture: selectedPicture,
              _csrf: csrfToken 
            }),
            credentials: 'same-origin'
          });

          // Check if response is JSON
          const contentType = response.headers.get('content-type');
          if (!contentType || !contentType.includes('application/json')) {
            const text = await response.text();
            console.error('Non-JSON response:', text);
            throw new Error('Server returned an invalid response. Please refresh the page and try again.');
          }

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.error || 'Failed to update profile picture');
          }

          // Show success message with custom styling
          const successMsg = 'üéâ Your profile photo has been updated successfully!';
          alert(successMsg);
          
          // Reload page to show new picture
          window.location.reload();
        } catch (error) {
          console.error('Error updating profile picture:', error);
          if (error.message.includes('JSON') || error.message.includes('invalid')) {
            alert('‚ö†Ô∏è An error occurred while updating your profile picture. Please refresh the page and try again.');
          } else {
            alert('‚ö†Ô∏è ' + (error.message || 'Failed to update profile picture. Please try again.'));
          }
          savePictureBtn.disabled = false;
          savePictureBtn.textContent = 'Save Picture';
        }
      });
    });
  </script>
</body>
</html>


