<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="icon"
      href="https://phshirt.com/wp-content/uploads/2022/01/UM-Tagum-College-1950.png"
      type="image/x-icon"
    />
    <script
      src="https://kit.fontawesome.com/64d58efce2.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="style.css" />
    <title>Sign in & Sign up Form</title>
  </head>
  <body>
    <div class="container">
      <div class="forms-container">
        <div class="signin-signup">
          <form action="#" class="sign-in-form" id="sign-in-form">
            <h2 class="title">Sign in</h2>
            <div class="input-field">
              <i class="fas fa-user-shield"></i>
              <select
                id="signin-role"
                aria-label="Select role"
                required
                autofocus
              >
                <option value="" disabled selected>Select role</option>
                <option value="member">Member</option>
                <option value="officer">Officer</option>
                <option value="admin">Admin</option>
              </select>
            </div>
            <div class="input-field">
              <i class="fas fa-user"></i>
              <input
                type="text"
                id="signin-umtcid"
                placeholder="UMTC ID (6 digits)"
                inputmode="numeric"
                pattern="[0-9]{6}"
                maxlength="6"
                required
              />
            </div>
            <div class="input-field">
              <i class="fas fa-lock"></i>
              <input
                type="password"
                id="signin-password"
                placeholder="Password"
                required
              />
            </div>
            <div class="options">
              <label for="remember-me" class="remember">
                <input type="checkbox" id="remember-me" />
                <span>Remember me</span>
              </label>
              <a href="#" id="forgot-password-link" class="forgot-link"
                >Forgot password?</a
              >
            </div>
            <input type="submit" value="Login" class="btn solid" />
          </form>
          <form action="#" class="sign-up-form" id="sign-up-form">
            <h2 class="title">Sign up</h2>
            <!-- Step 1 -->
            <div class="step active" data-step="1">
              <div class="input-field">
                <i class="fas fa-user"></i>
                <input
                  type="text"
                  id="signup-fullname"
                  placeholder="Full Name"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-id-card"></i>
                <input
                  type="text"
                  id="signup-umtcid"
                  placeholder="UMTC ID (6 digits)"
                  inputmode="numeric"
                  pattern="[0-9]{6}"
                  maxlength="6"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-envelope"></i>
                <input
                  type="email"
                  id="signup-email"
                  placeholder="University Email (@umindanao.edu.ph)"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  id="signup-password"
                  placeholder="Password"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  id="signup-confirm"
                  placeholder="Confirm Password"
                  required
                />
              </div>
              <div class="actions">
                <button type="button" class="btn" id="signup-next">Next</button>
              </div>
            </div>
            <!-- Step 2 -->
            <div class="step" data-step="2">
              <div class="input-field">
                <i class="fas fa-phone"></i>
                <input
                  type="tel"
                  id="signup-contact"
                  placeholder="Contact Number"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-graduation-cap"></i>
                <input
                  type="text"
                  id="signup-course"
                  placeholder="Course / Department"
                  required
                />
              </div>
              <div class="input-field">
                <i class="fas fa-layer-group"></i>
                <select id="signup-year" required>
                  <option value="" disabled selected>Year Level</option>
                  <option value="1st">1st Year</option>
                  <option value="2nd">2nd Year</option>
                  <option value="3rd">3rd Year</option>
                  <option value="4th">4th Year</option>
                  <option value="5th">5th Year</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="input-field">
                <i class="fas fa-venus-mars"></i>
                <select id="signup-gender">
                  <option value="" selected>Gender (optional)</option>
                  <option value="female">Female</option>
                  <option value="male">Male</option>
                  <option value="prefer-not">Prefer not to say</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="actions" style="display: flex; gap: 10px">
                <button type="button" class="btn transparent" id="signup-back">
                  Back
                </button>
                <input type="submit" class="btn" value="Create account" />
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="panels-container">
        <div class="panel left-panel">
          <div class="content">
            <h3>Welcome to UniClub</h3>
            <p>
              University of Mindanao! Join our vibrant community of students,
              explore your talents, and connect with like-minded peers. Sign up
              to start your journey or log in to continue your UNICLUB
              experience!
            </p>
            <button class="btn transparent" id="sign-up-btn">Sign up</button>
          </div>
          <img src="img/log.svg" class="image" alt="" />
        </div>
        <div class="panel right-panel">
          <div class="content">
            <h3>Be one of us</h3>
            <p>
              University of Mindanao! Join our vibrant community of students,
              explore your talents, and connect with like-minded peers. Sign up
              to start your journey or log in to continue your UNICLUB
              experience!
            </p>
            <button class="btn transparent" id="sign-in-btn">Sign In</button>
          </div>
          <img src="img/register.svg" class="image" alt="" />
        </div>
      </div>
    </div>

    <script>
      const sign_in_btn = document.querySelector("#sign-in-btn");
      const sign_up_btn = document.querySelector("#sign-up-btn");
      const container = document.querySelector(".container");
      const signInForm = document.querySelector("#sign-in-form");
      const signInRole = document.querySelector("#signin-role");
      const rememberCheckbox = document.querySelector("#remember-me");
      const forgotLink = document.querySelector("#forgot-password-link");
      
      // UMTC ID input restrictions - only allow numbers
      const umtcIdInput = document.querySelector("#signin-umtcid");
      if (umtcIdInput) {
        umtcIdInput.addEventListener("input", function(e) {
          // Remove any non-numeric characters
          this.value = this.value.replace(/[^0-9]/g, '');
          
          // Limit to 6 digits
          if (this.value.length > 6) {
            this.value = this.value.slice(0, 6);
          }
        });
        
        // Prevent pasting non-numeric content
        umtcIdInput.addEventListener("paste", function(e) {
          e.preventDefault();
          const paste = (e.clipboardData || window.clipboardData).getData('text');
          const numericOnly = paste.replace(/[^0-9]/g, '').slice(0, 6);
          this.value = numericOnly;
        });
      }
      
      // UMTC ID input restrictions for signup - only allow numbers
      const signupUmtcIdInput = document.querySelector("#signup-umtcid");
      if (signupUmtcIdInput) {
        signupUmtcIdInput.addEventListener("input", function(e) {
          // Remove any non-numeric characters
          this.value = this.value.replace(/[^0-9]/g, '');
          
          // Limit to 6 digits
          if (this.value.length > 6) {
            this.value = this.value.slice(0, 6);
          }
        });
        
        // Prevent pasting non-numeric content
        signupUmtcIdInput.addEventListener("paste", function(e) {
          e.preventDefault();
          const paste = (e.clipboardData || window.clipboardData).getData('text');
          const numericOnly = paste.replace(/[^0-9]/g, '').slice(0, 6);
          this.value = numericOnly;
        });
      }
      
      // Signup step elements
      const signupForm = document.querySelector("#sign-up-form");
      const steps = signupForm ? signupForm.querySelectorAll(".step") : [];
      const nextBtn = signupForm
        ? signupForm.querySelector("#signup-next")
        : null;
      const backBtn = signupForm
        ? signupForm.querySelector("#signup-back")
        : null;

      sign_up_btn.addEventListener("click", () => {
        container.classList.add("sign-up-mode");
      });

      sign_in_btn.addEventListener("click", () => {
        container.classList.remove("sign-up-mode");
        if (signInRole) {
          // force user to choose a role each time
          signInRole.value = "";
          signInRole.focus();
          // also attempt to open immediately (not just on focus)
          if (typeof signInRole.showPicker === "function") {
            try {
              signInRole.showPicker();
            } catch (e) {}
          } else {
            try {
              signInRole.dispatchEvent(
                new KeyboardEvent("keydown", {
                  key: "ArrowDown",
                  bubbles: true,
                })
              );
            } catch (e) {}
            try {
              signInRole.dispatchEvent(
                new MouseEvent("mousedown", {
                  bubbles: true,
                  cancelable: true,
                  view: window,
                })
              );
            } catch (e) {}
          }
        }
      });

      // Try to open the role dropdown automatically when it receives focus
      if (signInRole) {
        const tryOpenSelect = (sel) => {
          try {
            if (typeof sel.showPicker === "function") {
              sel.showPicker();
              return;
            }
          } catch (e) {}
          try {
            sel.dispatchEvent(
              new KeyboardEvent("keydown", { key: "ArrowDown", bubbles: true })
            );
          } catch (e) {}
          try {
            sel.dispatchEvent(
              new MouseEvent("mousedown", {
                bubbles: true,
                cancelable: true,
                view: window,
              })
            );
          } catch (e) {}
        };
        signInRole.addEventListener("focus", () => {
          // small timeout improves reliability across browsers
          setTimeout(() => tryOpenSelect(signInRole), 0);
        });
        // On initial load, if we're already on sign-in, focus and try to open once
        window.addEventListener("DOMContentLoaded", () => {
          const isSignInVisible = !container.classList.contains("sign-up-mode");
          if (isSignInVisible) {
            signInRole.focus();
            setTimeout(() => tryOpenSelect(signInRole), 0);
          }
        });
      }

      // Prefill from localStorage if "Remember me" was used
      (function prefillRemembered() {
        try {
          const remembered = localStorage.getItem("rememberUMTC") === "true";
          const savedId = localStorage.getItem("rememberUMTCId") || "";
          if (remembered) {
            rememberCheckbox.checked = true;
            if (savedId)
              document.querySelector("#signin-umtcid").value = savedId;
          }
          // Always require explicit role selection on load
          if (signInRole) signInRole.value = "";
        } catch (e) {
          // ignore storage errors (private mode, etc.)
        }
      })();

      // Basic role-based branching on sign-in
      signInForm.addEventListener("submit", (event) => {
        event.preventDefault();
        const umtcId = document.querySelector("#signin-umtcid").value.trim();
        const password = document.querySelector("#signin-password").value;
        const role = document.querySelector("#signin-role").value;

        // Enhanced UMTC ID validation
        if (!umtcId || umtcId.length === 0) {
          alert("Please enter your UMTC ID.");
          document.querySelector("#signin-umtcid").focus();
          return;
        }

        if (!/^\d{6}$/.test(umtcId)) {
          alert("UMTC ID must be exactly 6 digits (numbers only).");
          document.querySelector("#signin-umtcid").focus();
          return;
        }

        // Validate password
        if (!password || password.length === 0) {
          alert("Please enter your password.");
          document.querySelector("#signin-password").focus();
          return;
        }

        // Validate role selection
        if (!role || role === "") {
          alert("Please select your role.");
          document.querySelector("#signin-role").focus();
          return;
        }

        // Persist remember preferences
        try {
          if (rememberCheckbox.checked) {
            localStorage.setItem("rememberUMTC", "true");
            localStorage.setItem("rememberUMTCId", umtcId);
            localStorage.setItem("rememberRole", role);
          } else {
            localStorage.removeItem("rememberUMTC");
            localStorage.removeItem("rememberUMTCId");
            localStorage.removeItem("rememberRole");
          }
        } catch (e) {
          // ignore storage errors
        }

        // Hardcoded accounts for testing
        const hardcodedAccounts = {
          admin: [
            { id: "123456", password: "admin123", name: "Admin User" }
          ],
          officer: [
            { id: "234567", password: "officer123", name: "Officer User" }
          ],
          member: [
            { id: "345678", password: "member123", name: "Student Member" }
          ]
        };

        // Validate credentials against hardcoded accounts
        const roleAccounts = hardcodedAccounts[role];
        if (!roleAccounts) {
          alert("Invalid role selected.");
          return;
        }

        const validAccount = roleAccounts.find(account => 
          account.id === umtcId && account.password === password
        );

        if (!validAccount) {
          alert(`Invalid credentials for ${role}. Please check your UMTC ID and password.`);
          return;
        }

        // Store user session data
        try {
          localStorage.setItem("isLoggedIn", "true");
          localStorage.setItem("userRole", role);
          localStorage.setItem("userUMTCId", umtcId);
          localStorage.setItem("userName", validAccount.name);
          localStorage.setItem("loginTime", new Date().toISOString());
        } catch (e) {
          console.warn("Failed to store session data:", e);
        }

        // Show success message and redirect based on role
        switch (role) {
          case "member":
            alert(`Welcome ${validAccount.name}! Signed in as Member (ID: ${umtcId})`);
            window.location.href = "../Student/stundent.htm";
            break;
          case "officer":
            alert(`Welcome ${validAccount.name}! Signed in as Officer (ID: ${umtcId})`);
            window.location.href = "../Officers/index.htm";
            break;
          case "admin":
            alert(`Welcome ${validAccount.name}! Signed in as Admin (ID: ${umtcId})`);
            window.location.href = "../Admin/Admin.htm";
            break;
          default:
            alert("Unknown role selected.");
        }
      });

      // Forgot password handler (placeholder)
      forgotLink.addEventListener("click", (e) => {
        e.preventDefault();
        const currentId = document.querySelector("#signin-umtcid").value.trim();
        const idForReset =
          currentId || prompt("Enter your UMTC ID to reset password:") || "";
        if (!idForReset) return;
        alert(`Password reset link would be sent for ID: ${idForReset}`);
        // Implement actual reset flow: open reset page or call API
        // window.location.href = `reset-password.html?umtcId=${encodeURIComponent(idForReset)}`;
      });

      // ===== Signup multi-step logic =====
      function showStep(stepIndex) {
        if (!steps || steps.length === 0) return;
        steps.forEach((el, idx) => {
          if (idx === stepIndex) {
            el.classList.add("active");
          } else {
            el.classList.remove("active");
          }
        });
      }
      let currentStep = 0;
      showStep(currentStep);

      function validateStep1() {
        const name = document.querySelector("#signup-fullname").value.trim();
        const umtcId = document.querySelector("#signup-umtcid").value.trim();
        const email = document.querySelector("#signup-email").value.trim();
        const pass = document.querySelector("#signup-password").value;
        const confirm = document.querySelector("#signup-confirm").value;
        if (!name || !umtcId || !email || !pass || !confirm) {
          alert("Please complete all fields including UMTC ID.");
          return false;
        }
        // UMTC ID must be exactly 6 digits
        if (!/^\d{6}$/.test(umtcId)) {
          alert("UMTC ID must be exactly 6 digits.");
          return false;
        }
        // Password strength checks
        const hasUpper = /[A-Z]/.test(pass);
        const hasNumber = /\d/.test(pass);
        const hasSymbol = /[^A-Za-z0-9]/.test(pass);
        const commonPw = [
          "password",
          "123456",
          "123456789",
          "qwerty",
          "abc123",
          "111111",
          "123123",
          "password1",
          "1234",
          "12345",
          "iloveyou",
          "admin",
          "welcome",
        ];
        if (!hasUpper) {
          alert("Password must contain at least one uppercase letter.");
          return false;
        }
        if (!hasNumber) {
          alert("Password must contain at least one number.");
          return false;
        }
        if (!hasSymbol) {
          alert("Password must contain at least one symbol.");
          return false;
        }
        if (commonPw.includes(pass.toLowerCase())) {
          alert("Password is too common. Please choose a stronger password.");
          return false;
        }
        const domainOk = /@umindanao\.edu\.ph$/i.test(email);
        if (!domainOk) {
          alert(
            "Please use your university email ending with @umindanao.edu.ph"
          );
          return false;
        }
        if (pass !== confirm) {
          alert("Passwords do not match.");
          return false;
        }
        return true;
      }

      if (nextBtn) {
        nextBtn.addEventListener("click", () => {
          if (!validateStep1()) return;
          currentStep = 1;
          showStep(currentStep);
        });
      }
      if (backBtn) {
        backBtn.addEventListener("click", () => {
          currentStep = 0;
          showStep(currentStep);
        });
      }

      if (signupForm) {
        signupForm.addEventListener("submit", (e) => {
          e.preventDefault();
          // Basic presence validation for step 2
          const contact = document
            .querySelector("#signup-contact")
            .value.trim();
          const course = document.querySelector("#signup-course").value.trim();
          const year = document.querySelector("#signup-year").value;
          if (!contact || !course || !year) {
            alert("Please fill out contact, course and year level.");
            return;
          }
          alert("Signup successful!");
          // TODO: replace with actual signup API call
        });
      }
    </script>
  </body>
</html>
